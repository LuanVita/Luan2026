<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LuanOS 6.2 | Refined Executive System</title>
    
    <!-- Bibliotecas -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap');
        
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #020617; color: #f8fafc; overflow: hidden; }

        /* Glassmorphism Refinado */
        .glass-panel { background: rgba(15, 23, 42, 0.7); backdrop-filter: blur(24px); -webkit-backdrop-filter: blur(24px); border: 1px solid rgba(255, 255, 255, 0.05); box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4); }
        .glass-active { background: rgba(30, 41, 59, 0.9); border: 1px solid rgba(255, 255, 255, 0.1); box-shadow: 0 0 15px rgba(59, 130, 246, 0.1); }

        /* Scrollbar Fina */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
        
        /* Anima√ß√µes Suaves & Icon Glow */
        .card-hover { transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1); }
        .card-hover:hover { transform: translateY(-4px); border-color: rgba(255,255,255,0.15); box-shadow: 0 10px 30px -10px rgba(0,0,0,0.5); }
        
        /* Novo Efeito de √çcones */
        .nav-btn i, .glass-panel i { transition: all 0.3s ease; }
        .nav-btn:hover i, .glass-panel:hover i { 
            text-shadow: 0 0 10px currentColor; 
            transform: scale(1.1);
            filter: brightness(1.3);
        }

        .fade-in { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Flashcard Flip */
        .flashcard { perspective: 1000px; height: 180px; cursor: pointer; }
        .flashcard-inner { position: relative; width: 100%; height: 100%; text-align: center; transition: transform 0.6s; transform-style: preserve-3d; }
        .flashcard.flipped .flashcard-inner { transform: rotateY(180deg); }
        .flashcard-front, .flashcard-back { position: absolute; width: 100%; height: 100%; -webkit-backface-visibility: hidden; backface-visibility: hidden; display: flex; align-items: center; justify-content: center; border-radius: 1rem; padding: 1rem; flex-direction: column; }
        .flashcard-front { background: rgba(30, 41, 59, 0.9); border: 1px solid rgba(139, 92, 246, 0.2); }
        .flashcard-back { background: rgba(76, 29, 149, 0.9); transform: rotateY(180deg); border: 1px solid rgba(167, 139, 250, 0.4); }

        /* Custom Checkbox */
        .custom-checkbox input:checked + div { background-color: #22c55e; border-color: #22c55e; color: white; }
        .custom-checkbox input:checked + div svg { display: block; }
        
        /* Timeline V4 */
        .timeline-line { position: absolute; left: 28px; top: 20px; bottom: 20px; width: 2px; background: linear-gradient(to bottom, #22c55e 0%, #334155 100%); z-index: 0; }
        
        /* Audio Wave */
        .listening-wave { display: inline-flex; align-items: center; gap: 2px; height: 16px; }
        .listening-wave span { width: 3px; height: 100%; background: #ef4444; border-radius: 2px; animation: wave 1s infinite ease-in-out; }
        .listening-wave span:nth-child(2) { animation-delay: 0.1s; }
        .listening-wave span:nth-child(3) { animation-delay: 0.2s; }
        @keyframes wave { 0%, 100% { height: 4px; } 50% { height: 16px; } }

        /* Chat Themes */
        .theme-tutor .chat-bubble-ai { border-color: rgba(139, 92, 246, 0.3); background: rgba(76, 29, 149, 0.4); color: #e2e8f0; }
        .theme-coach .chat-bubble-ai { border-color: rgba(16, 185, 129, 0.3); background: rgba(6, 78, 59, 0.4); color: #e2e8f0; }
        .chat-bubble-user { background: #3b82f6; color: white; border-radius: 12px 12px 0 12px; }
        .chat-bubble-ai { border-radius: 12px 12px 12px 0; border: 1px solid; }

        /* Routine Grid */
        .schedule-grid { display: grid; grid-template-columns: 50px repeat(5, 1fr); gap: 1px; background-color: rgba(255,255,255,0.03); border-radius: 16px; overflow: hidden; border: 1px solid rgba(255,255,255,0.05); }
        .schedule-header { background-color: rgba(30, 41, 59, 0.9); padding: 12px 5px; text-align: center; font-size: 0.7rem; font-weight: 700; color: #94a3b8; text-transform: uppercase; letter-spacing: 0.05em; }
        .schedule-time { padding: 10px 5px; text-align: right; font-size: 0.65rem; color: #64748b; background: rgba(15, 23, 42, 0.5); border-right: 1px solid rgba(255,255,255,0.05); font-weight: 600; }
        .schedule-cell { background-color: rgba(15, 23, 42, 0.3); min-height: 50px; position: relative; }
        .event-block { position: absolute; left: 3px; right: 3px; top: 2px; bottom: 2px; border-radius: 6px; padding: 4px 8px; font-size: 0.65rem; font-weight: 600; color: white; display: flex; flex-direction: column; justify-content: center; line-height: 1.2; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        .evt-english { background: linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%); border-left: 3px solid #a78bfa; }
        .evt-health { background: linear-gradient(135deg, #059669 0%, #047857 100%); border-left: 3px solid #34d399; }
        .evt-v4 { background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%); border-left: 3px solid #f87171; }
        .evt-freela { background: linear-gradient(135deg, #d97706 0%, #92400e 100%); border-left: 3px solid #fbbf24; }
        .evt-study { background: linear-gradient(135deg, #4f46e5 0%, #312e81 100%); border-left: 3px solid #818cf8; }
    </style>
</head>
<body class="flex h-screen selection:bg-blue-500 selection:text-white">

    <!-- SIDEBAR -->
    <aside class="w-20 lg:w-72 glass-panel border-r-0 flex flex-col justify-between z-50">
        <div class="h-24 flex items-center justify-center lg:justify-start lg:px-8 border-b border-white/5">
            <div class="relative group cursor-pointer" onclick="document.getElementById('photo-upload').click()">
                <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-blue-600 to-indigo-600 flex items-center justify-center text-white font-bold text-xl shadow-lg shadow-blue-500/20 overflow-hidden border-2 border-white/10 relative">
                    <img id="user-photo" src="" class="w-full h-full object-cover hidden">
                    <span id="user-initial" class="absolute">L</span>
                    <div class="absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition"><i class="fa-solid fa-camera text-xs"></i></div>
                </div>
                <input type="file" id="photo-upload" class="hidden" accept="image/*" onchange="uploadPhoto(this)">
                <div class="absolute -bottom-1 -right-1 w-3 h-3 bg-green-500 rounded-full border-2 border-slate-900"></div>
            </div>
            <div class="ml-4 hidden lg:block">
                <h1 class="font-bold text-lg tracking-wide text-white">Luan Vita</h1>
                <p class="text-xs text-slate-400">Planejamento 2026</p>
            </div>
        </div>

        <nav class="flex-1 px-4 py-8 space-y-2">
            <button onclick="switchTab('dashboard')" id="nav-dashboard" class="nav-btn w-full flex items-center p-3.5 rounded-xl bg-white/10 text-white transition-all group active-nav">
                <i class="fa-solid fa-grid-2 text-xl w-8 text-center text-blue-400"></i>
                <span class="ml-3 font-medium hidden lg:block">Vis√£o Geral</span>
            </button>
            <p class="hidden lg:block px-4 mt-6 mb-2 text-[10px] font-bold text-slate-500 uppercase tracking-widest">√Åreas de Foco</p>
            <button onclick="switchTab('v4')" id="nav-v4" class="nav-btn w-full flex items-center p-3.5 rounded-xl text-slate-400 hover:bg-white/5 hover:text-white transition-all group"><i class="fa-solid fa-building text-xl w-8 text-center group-hover:text-red-400"></i><span class="ml-3 font-medium hidden lg:block">Carreira V4</span></button>
            <button onclick="switchTab('freela')" id="nav-freela" class="nav-btn w-full flex items-center p-3.5 rounded-xl text-slate-400 hover:bg-white/5 hover:text-white transition-all group"><i class="fa-solid fa-briefcase text-xl w-8 text-center group-hover:text-yellow-400"></i><span class="ml-3 font-medium hidden lg:block">Ag√™ncia Freela</span></button>
            <button onclick="switchTab('english')" id="nav-english" class="nav-btn w-full flex items-center p-3.5 rounded-xl text-slate-400 hover:bg-white/5 hover:text-white transition-all group"><i class="fa-solid fa-earth-americas text-xl w-8 text-center group-hover:text-purple-400"></i><span class="ml-3 font-medium hidden lg:block">Jornada Ingl√™s</span></button>
            <button onclick="switchTab('routine')" id="nav-routine" class="nav-btn w-full flex items-center p-3.5 rounded-xl text-slate-400 hover:bg-white/5 hover:text-white transition-all group"><i class="fa-regular fa-calendar-check text-xl w-8 text-center group-hover:text-green-400"></i><span class="ml-3 font-medium hidden lg:block">Rotina</span></button>
        </nav>

        <div class="p-6 border-t border-white/5 hidden lg:block">
            <div class="bg-white/5 rounded-xl p-4 border border-white/5">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-xs text-slate-400 font-semibold">META (9K)</span>
                    <span class="text-xs text-white font-bold" id="global-progress-text">41%</span>
                </div>
                <div class="w-full bg-slate-700 h-1.5 rounded-full overflow-hidden">
                    <div id="global-progress-bar" class="bg-gradient-to-r from-blue-500 to-indigo-500 h-full w-[41%] shadow-[0_0_10px_rgba(59,130,246,0.5)] transition-all duration-1000"></div>
                </div>
            </div>
        </div>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="flex-1 relative overflow-y-auto bg-gradient-to-br from-slate-950 via-[#0a0f1e] to-slate-950">
        
        <header class="h-24 flex items-center justify-between px-8 sticky top-0 z-40 backdrop-blur-sm bg-slate-950/50">
            <div>
                <h2 id="page-title" class="text-2xl font-bold text-white">Dashboard</h2>
                <p class="text-sm text-slate-400 flex items-center gap-2"><span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span> Sistema Ativo</p>
            </div>
            <div class="text-right hidden md:block opacity-70 hover:opacity-100 transition cursor-help" title="Dados salvos automaticamente">
                <p class="text-[10px] text-green-400 font-bold uppercase tracking-wider"><i class="fa-solid fa-database mr-1"></i> Auto-Save On</p>
            </div>
        </header>

        <div class="p-8 max-w-[1600px] mx-auto pb-32">

            <!-- ================= VIEW: DASHBOARD ================= -->
            <div id="view-dashboard" class="view-section fade-in">
                
                <!-- Status Bar -->
                <div class="glass-panel p-4 rounded-2xl mb-6 flex items-center justify-between border-l-4 border-blue-500">
                    <div class="flex items-center gap-4">
                        <div class="w-10 h-10 rounded-full bg-blue-500/10 flex items-center justify-center text-blue-400"><i class="fa-solid fa-wallet"></i></div>
                        <div>
                            <p class="text-xs text-slate-400 uppercase font-bold">Renda Mensal Total</p>
                            <div class="flex items-baseline gap-2">
                                <h3 class="text-2xl font-bold text-white" id="main-total-income">R$ 3.700,00</h3>
                                <span class="text-xs text-slate-500">de R$ 9.000,00</span>
                            </div>
                        </div>
                    </div>
                    <div class="flex-1 mx-8 hidden md:block">
                        <div class="flex justify-between text-xs text-slate-400 mb-1"><span>Progresso da Meta</span><span id="main-progress-pct">41%</span></div>
                        <div class="w-full bg-slate-800 h-2 rounded-full overflow-hidden"><div id="main-progress-bar" class="bg-gradient-to-r from-blue-500 to-green-400 h-full w-[41%] shadow-[0_0_10px_rgba(59,130,246,0.5)] transition-all duration-1000"></div></div>
                    </div>
                    <div class="text-right hidden md:block">
                        <span class="text-xs bg-green-500/10 text-green-400 px-2 py-1 rounded border border-green-500/20">Em Crescimento</span>
                    </div>
                </div>

                <!-- Cards -->
                <div class="grid grid-cols-1 md:grid-cols-4 lg:grid-cols-4 gap-6 mb-6">
                    <!-- V4 Status (CORRIGIDO) -->
                    <div class="glass-panel p-6 rounded-3xl col-span-1 md:col-span-2 relative overflow-hidden group card-hover">
                        <div class="absolute top-0 right-0 w-32 h-32 bg-red-500/10 rounded-full blur-[50px] transition group-hover:bg-red-500/20"></div>
                        <div class="flex justify-between items-start mb-4">
                            <div><span class="text-xs font-bold text-red-400 uppercase tracking-widest bg-red-500/10 px-2 py-1 rounded border border-red-500/20">Principal</span><h3 class="text-3xl font-bold text-white mt-2">V4 Company</h3></div>
                            <div class="text-right">
                                <p class="text-xs text-slate-400 uppercase">Meta</p>
                                <p class="text-xl font-bold text-white">R$ 6.000</p>
                            </div>
                        </div>
                        <div class="relative pt-2">
                            <div class="flex justify-between text-xs text-slate-400 mb-2 font-mono">
                                <span>Atual: <span id="dash-v4-current-mini" class="text-white">R$ 3.700</span></span>
                                <span id="dash-v4-pct">61%</span>
                            </div>
                            <div class="w-full bg-slate-800 h-3 rounded-full overflow-hidden">
                                <div id="dash-v4-bar" class="bg-gradient-to-r from-red-600 to-orange-600 h-full w-[61%] transition-all duration-1000"></div>
                            </div>
                        </div>
                    </div>
                    <!-- Income Dist -->
                    <div class="glass-panel p-6 rounded-3xl col-span-1 relative card-hover flex flex-col justify-between">
                        <div class="flex justify-between items-start mb-2"><p class="text-slate-400 text-xs uppercase font-bold">Mix de Renda</p><i class="fa-solid fa-chart-pie text-slate-600"></i></div>
                        <div class="h-32 relative"><canvas id="incomeDistChart"></canvas><div class="absolute inset-0 flex items-center justify-center pointer-events-none"><span class="text-xs text-slate-500 font-bold">Mix</span></div></div>
                    </div>
                    <!-- Mindset -->
                    <div class="glass-panel p-6 rounded-3xl col-span-1 relative card-hover flex flex-col justify-center items-center text-center bg-gradient-to-br from-indigo-900/40 to-slate-900/40 border border-indigo-500/20">
                        <i class="fa-solid fa-quote-left text-3xl text-yellow-500 mb-3"></i>
                        <p class="text-sm font-medium text-white leading-relaxed italic">"Somos o que fazemos repetidamente. A excel√™ncia, portanto, n√£o √© um ato, mas um h√°bito."</p>
                        <p class="text-[10px] text-slate-400 mt-2 uppercase tracking-widest font-bold">Arist√≥teles</p>
                    </div>
                </div>

                <!-- Secondary Metrics -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                    <div class="glass-panel p-5 rounded-2xl flex flex-col justify-between card-hover border-b-4 border-emerald-500 relative">
                        <div class="flex justify-between items-start"><div class="flex items-center gap-3"><div class="w-10 h-10 rounded-xl bg-emerald-500/10 flex items-center justify-center text-emerald-400 text-lg"><i class="fa-solid fa-sack-dollar"></i></div><div><p class="text-[10px] text-slate-400 uppercase font-bold tracking-wider">Investimentos</p><h3 class="text-2xl font-black text-white" id="inv-current">R$ 8.500</h3></div></div><button onclick="addInvestment()" class="text-xs bg-emerald-600 hover:bg-emerald-500 text-white w-8 h-8 rounded-full flex items-center justify-center transition shadow-lg"><i class="fa-solid fa-plus"></i></button></div>
                        <div class="mt-4"><div class="flex justify-between text-[10px] text-slate-400 mb-1"><span>Progresso</span><span id="inv-pct">38%</span></div><div class="w-full bg-slate-800 h-1.5 rounded-full overflow-hidden"><div id="inv-bar" class="bg-emerald-500 h-full w-[38%]"></div></div><p class="text-[10px] text-right text-emerald-400/60 mt-1">Meta: R$ 22.000</p></div>
                    </div>
                    <div class="glass-panel p-5 rounded-2xl flex items-center gap-4 card-hover border-b-4 border-orange-500">
                        <div class="w-12 h-12 rounded-xl bg-orange-500/10 flex items-center justify-center text-orange-400 text-xl"><i class="fa-solid fa-hourglass-half"></i></div>
                        <div><p class="text-[10px] text-slate-400 uppercase font-bold tracking-wider">Pr√≥ximo Salto (Fev/26)</p><h3 class="text-2xl font-black text-white flex items-baseline gap-1">34 <span class="text-sm font-normal text-slate-500">dias</span></h3></div>
                    </div>
                    <div class="glass-panel p-5 rounded-2xl flex items-center gap-4 card-hover border-b-4 border-purple-500 relative overflow-hidden">
                        <div class="absolute right-0 top-0 p-4 opacity-10"><i class="fa-solid fa-earth-americas text-6xl text-purple-500"></i></div>
                        <div class="w-12 h-12 rounded-xl bg-purple-500/10 flex items-center justify-center text-purple-400 text-xl"><i class="fa-solid fa-language"></i></div>
                        <div><p class="text-[10px] text-slate-400 uppercase font-bold tracking-wider">N√≠vel de Ingl√™s</p><h3 class="text-3xl font-black text-white" id="dash-english-lvl">A1</h3><p class="text-[10px] text-slate-500">Autom√°tico via Jornada</p></div>
                    </div>
                </div>

                <!-- Mid Row: Certifications & Journal -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                    <div class="glass-panel p-6 rounded-3xl col-span-2">
                        <div class="flex justify-between items-center mb-4"><h3 class="font-bold text-white"><i class="fa-solid fa-award text-yellow-500 mr-2"></i>Certifica√ß√µes T√©cnicas</h3><span class="text-xs text-slate-400">Curr√≠culo de Elite</span></div>
                        <div class="grid grid-cols-2 gap-3 max-h-48 overflow-y-auto pr-1">
                            <label class="custom-checkbox flex items-center p-2.5 bg-slate-800/50 rounded-xl cursor-pointer hover:bg-slate-800 border border-slate-700/50 transition"><input type="checkbox" class="sr-only save-checkbox cert-check" id="cert-search" onchange="calculatePromotion()"><div class="w-4 h-4 border-2 border-slate-500 rounded flex items-center justify-center mr-3 transition-colors flex-shrink-0 bg-slate-900"><svg class="w-3 h-3 text-white hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg></div><span class="text-xs text-slate-300">Google Ads Search</span></label>
                            <label class="custom-checkbox flex items-center p-2.5 bg-slate-800/50 rounded-xl cursor-pointer hover:bg-slate-800 border border-slate-700/50 transition"><input type="checkbox" class="sr-only save-checkbox cert-check" id="cert-creative" onchange="calculatePromotion()"><div class="w-4 h-4 border-2 border-slate-500 rounded flex items-center justify-center mr-3 transition-colors flex-shrink-0 bg-slate-900"><svg class="w-3 h-3 text-white hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg></div><span class="text-xs text-slate-300">Google Ads Criativos</span></label>
                            <label class="custom-checkbox flex items-center p-2.5 bg-slate-800/50 rounded-xl cursor-pointer hover:bg-slate-800 border border-slate-700/50 transition"><input type="checkbox" class="sr-only save-checkbox cert-check" id="cert-shopping" onchange="calculatePromotion()"><div class="w-4 h-4 border-2 border-slate-500 rounded flex items-center justify-center mr-3 transition-colors flex-shrink-0 bg-slate-900"><svg class="w-3 h-3 text-white hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg></div><span class="text-xs text-slate-300">Google Ads Shopping</span></label>
                            <label class="custom-checkbox flex items-center p-2.5 bg-slate-800/50 rounded-xl cursor-pointer hover:bg-slate-800 border border-slate-700/50 transition"><input type="checkbox" class="sr-only save-checkbox cert-check" id="cert-linkedin" onchange="calculatePromotion()"><div class="w-4 h-4 border-2 border-slate-500 rounded flex items-center justify-center mr-3 transition-colors flex-shrink-0 bg-slate-900"><svg class="w-3 h-3 text-white hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg></div><span class="text-xs text-slate-300">Intro LinkedIn Ads</span></label>
                            <label class="custom-checkbox flex items-center p-2.5 bg-slate-800/50 rounded-xl cursor-pointer hover:bg-slate-800 border border-slate-700/50 transition"><input type="checkbox" class="sr-only save-checkbox cert-check" id="cert-video" onchange="calculatePromotion()"><div class="w-4 h-4 border-2 border-slate-500 rounded flex items-center justify-center mr-3 transition-colors flex-shrink-0 bg-slate-900"><svg class="w-3 h-3 text-white hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg></div><span class="text-xs text-slate-300">Google Ads V√≠deo</span></label>
                            <label class="custom-checkbox flex items-center p-2.5 bg-slate-800/50 rounded-xl cursor-pointer hover:bg-slate-800 border border-slate-700/50 transition"><input type="checkbox" class="sr-only save-checkbox cert-check" id="cert-metrics" onchange="calculatePromotion()"><div class="w-4 h-4 border-2 border-slate-500 rounded flex items-center justify-center mr-3 transition-colors flex-shrink-0 bg-slate-900"><svg class="w-3 h-3 text-white hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg></div><span class="text-xs text-slate-300">Google Ads M√©tricas</span></label>
                            <label class="custom-checkbox flex items-center p-2.5 bg-slate-800/50 rounded-xl cursor-pointer hover:bg-slate-800 border border-slate-700/50 transition"><input type="checkbox" class="sr-only save-checkbox cert-check" id="cert-make" onchange="calculatePromotion()"><div class="w-4 h-4 border-2 border-slate-500 rounded flex items-center justify-center mr-3 transition-colors flex-shrink-0 bg-slate-900"><svg class="w-3 h-3 text-white hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg></div><span class="text-xs text-slate-300">Make Foundation</span></label>
                        </div>
                    </div>
                    <div class="glass-panel p-4 rounded-xl col-span-1 border border-white/10 flex flex-col">
                        <h4 class="font-bold text-white text-sm mb-2"><i class="fa-solid fa-pen-nib text-purple-400 mr-2"></i>Di√°rio de Bordo 2026</h4>
                        <textarea id="planning-journal" class="w-full bg-slate-900/50 border border-slate-700 rounded-lg p-3 text-xs text-slate-300 flex-1 outline-none focus:border-purple-500 resize-none" placeholder="Insights gerais sobre o planejamento..."></textarea>
                    </div>
                </div>

                <!-- Bottom Row: Chart -->
                <div class="glass-panel p-6 rounded-3xl border-t-4 border-blue-500">
                    <h3 class="font-bold text-white text-lg mb-6">Evolu√ß√£o Financeira</h3>
                    <div class="h-64 w-full"><canvas id="financeChart"></canvas></div>
                </div>
            </div>

            <!-- ================= VIEW: V4 ================= -->
            <div id="view-v4" class="view-section hidden fade-in">
                <div class="flex justify-between items-end mb-8">
                    <h2 class="text-3xl font-bold text-white">Escalada Corporativa</h2>
                    <div class="text-right"><p class="text-xs text-slate-400">Sal√°rio Atual</p><p class="text-2xl font-bold text-green-400" id="v4-salary-display">R$ 3.700</p></div>
                </div>
                
                <div class="glass-panel p-5 rounded-2xl mb-8 border border-blue-500/20 bg-blue-900/10 relative overflow-hidden">
                    <div class="flex justify-between items-center mb-2 relative z-10"><h4 class="font-bold text-white flex items-center gap-2"><i class="fa-solid fa-chart-line text-blue-400"></i> Probabilidade de Promo√ß√£o</h4><span class="text-2xl font-bold text-blue-400" id="promo-pct-text">0%</span></div>
                    <div class="w-full bg-slate-800 h-2 rounded-full overflow-hidden relative z-10"><div id="promo-pct-bar" class="bg-blue-500 h-full w-[0%] transition-all duration-1000"></div></div>
                    <p class="text-xs text-slate-400 mt-2 relative z-10">Baseado em certifica√ß√µes e checkpoints conclu√≠dos.</p>
                </div>

                <div class="relative max-w-4xl mx-auto pb-12">
                    <div class="timeline-line"></div>
                    <div class="relative pl-24 pb-12 group"><div class="absolute left-6 top-2 w-4 h-4 bg-green-500 rounded-full border-4 border-slate-950 z-10"></div><div class="glass-panel p-6 rounded-2xl border border-green-500/20"><div class="flex justify-between items-start"><div><span class="text-green-400 font-bold text-xs uppercase tracking-wider mb-1 block">Jan 2026</span><h3 class="text-xl font-bold text-white">Analista Operacional</h3><p class="text-slate-400 text-sm mt-1">Foco: Entregas sem erro.</p></div><div class="text-right"><p class="text-2xl font-bold text-white">R$ 3.700</p></div></div></div></div>
                    <div class="relative pl-24 pb-12 group"><div class="absolute left-6 top-2 w-4 h-4 bg-slate-700 rounded-full border-4 border-slate-950 z-10"></div><div class="glass-panel p-6 rounded-2xl border border-white/5 hover:border-white/20 transition"><div class="flex justify-between items-start"><div><span class="text-slate-500 font-bold text-xs uppercase tracking-wider mb-1 block">Fev 2026</span><h3 class="text-xl font-bold text-white">Performance Boost</h3><ul class="text-slate-400 text-sm mt-2 list-disc pl-4"><li>NPS > 75</li><li>Zero erros</li></ul></div><div class="text-right flex flex-col items-end"><p class="text-2xl font-bold text-slate-300">R$ 4.200</p><button onclick="updateV4Salary(4200, this)" class="bg-slate-700 hover:bg-green-600 text-white text-xs px-3 py-1.5 mt-2 rounded transition">Confirmar</button></div></div></div></div>
                    <div class="relative pl-24 pb-12 group"><div class="absolute left-6 top-2 w-4 h-4 bg-slate-700 rounded-full border-4 border-slate-950 z-10"></div><div class="glass-panel p-6 rounded-2xl border border-white/5 hover:border-white/20 transition"><div class="flex justify-between items-start"><div><span class="text-slate-500 font-bold text-xs uppercase tracking-wider mb-1 block">Mai 2026</span><h3 class="text-xl font-bold text-white">Especialista</h3><ul class="text-slate-400 text-sm mt-2 list-disc pl-4"><li>Google Ads Cert</li><li>GA4 Expert</li></ul></div><div class="text-right flex flex-col items-end"><p class="text-2xl font-bold text-slate-300">R$ 4.700</p><button onclick="updateV4Salary(4700, this)" class="bg-slate-700 hover:bg-green-600 text-white text-xs px-3 py-1.5 mt-2 rounded transition">Confirmar</button></div></div></div></div>
                    <div class="relative pl-24 pb-12 group"><div class="absolute left-6 top-2 w-4 h-4 bg-slate-700 rounded-full border-4 border-slate-950 z-10"></div><div class="glass-panel p-6 rounded-2xl border border-white/5 hover:border-white/20 transition"><div class="flex justify-between items-start"><div><span class="text-slate-500 font-bold text-xs uppercase tracking-wider mb-1 block">Set 2026</span><h3 class="text-xl font-bold text-white">Key Account</h3><ul class="text-slate-400 text-sm mt-2 list-disc pl-4"><li>Contas High-Ticket</li><li>Mentoria</li></ul></div><div class="text-right flex flex-col items-end"><p class="text-2xl font-bold text-slate-300">R$ 5.350</p><button onclick="updateV4Salary(5350, this)" class="bg-slate-700 hover:bg-green-600 text-white text-xs px-3 py-1.5 mt-2 rounded transition">Confirmar</button></div></div></div></div>
                    <div class="relative pl-24 group"><div class="absolute left-6 top-2 w-4 h-4 bg-slate-700 rounded-full border-4 border-slate-950 z-10"></div><div class="glass-panel p-6 rounded-2xl border border-white/5 hover:border-red-500/30 transition"><div class="flex justify-between items-start"><div><span class="text-slate-500 font-bold text-xs uppercase tracking-wider mb-1 block">Dez 2026</span><h3 class="text-xl font-bold text-white">Lideran√ßa</h3><ul class="text-slate-400 text-sm mt-2 list-disc pl-4"><li>Ciclo Completo</li><li>Internacionaliza√ß√£o</li></ul></div><div class="text-right flex flex-col items-end"><p class="text-3xl font-bold text-red-500">R$ 6.000</p><button onclick="updateV4Salary(6000, this)" class="bg-slate-700 hover:bg-green-600 text-white text-xs px-3 py-1.5 mt-2 rounded transition">Confirmar</button></div></div></div></div>
                </div>
            </div>

            <!-- ================= VIEW: FREELA ================= -->
            <div id="view-freela" class="view-section hidden fade-in">
                <div class="flex justify-between items-end mb-8">
                    <div><h2 class="text-3xl font-bold text-white">Ag√™ncia Freelance</h2><p class="text-slate-400 mt-1">Gest√£o de Clientes & Contratos</p></div>
                    <button onclick="openClientModal()" class="bg-yellow-500 hover:bg-yellow-400 text-slate-900 font-bold px-6 py-3 rounded-xl shadow-lg transition flex items-center gap-2"><i class="fa-solid fa-plus"></i> Novo Contrato</button>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <!-- NEW META WIDGET -->
                    <div class="glass-panel p-5 rounded-2xl col-span-1 bg-yellow-900/10 border border-yellow-500/20">
                        <div class="flex justify-between items-center mb-2"><p class="text-xs text-yellow-500 uppercase font-bold">Meta Mensal</p><i class="fa-solid fa-flag text-yellow-500"></i></div>
                        <div class="w-full bg-slate-800 h-2 rounded-full overflow-hidden mb-1"><div id="freela-goal-bar" class="bg-yellow-500 h-full w-0 transition-all duration-1000"></div></div>
                        <p class="text-[10px] text-right text-slate-400">Alvo: R$ 3.000</p>
                    </div>
                    <div class="glass-panel p-5 rounded-2xl col-span-1 flex items-center gap-4">
                        <div class="w-10 h-10 rounded-full bg-blue-500/10 flex items-center justify-center text-blue-500"><i class="fa-solid fa-tag"></i></div>
                        <div><p class="text-xs text-slate-400 uppercase font-bold">Ticket M√©dio</p><p class="text-lg font-bold text-white" id="crm-avg-ticket">R$ 0,00</p></div>
                    </div>
                    <div class="glass-panel p-5 rounded-2xl col-span-1 flex items-center gap-4">
                        <div class="w-10 h-10 rounded-full bg-green-500/10 flex items-center justify-center text-green-500"><i class="fa-solid fa-sack-dollar"></i></div>
                        <div><p class="text-xs text-slate-400 uppercase font-bold">LTV Total</p><p class="text-lg font-bold text-white" id="crm-ltv">R$ 0,00</p></div>
                    </div>
                    <div class="glass-panel p-5 rounded-2xl col-span-1 flex items-center gap-4">
                        <div class="w-10 h-10 rounded-full bg-yellow-500/10 flex items-center justify-center text-yellow-500"><i class="fa-solid fa-money-bill-wave"></i></div>
                        <div><p class="text-xs text-slate-400 uppercase font-bold">MRR Atual</p><p class="text-lg font-bold text-white" id="crm-mrr">R$ 0,00</p></div>
                    </div>
                </div>

                <div id="clients-container" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6"></div>
            </div>

            <!-- ================= VIEW: ENGLISH ================= -->
            <div id="view-english" class="view-section hidden fade-in">
                <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 h-auto">
                    <!-- Left: Levels & Decks -->
                    <div class="lg:col-span-4 flex flex-col h-full gap-4">
                        
                        <!-- RESTORED LEVELS -->
                        <div class="glass-panel p-6 rounded-2xl border border-purple-500/20">
                            <h3 class="font-bold text-white mb-4">Progresso de N√≠vel</h3>
                            <div class="space-y-3">
                                <div class="flex items-center justify-between p-3 bg-slate-800/50 rounded-xl border border-slate-700"><div><p class="font-bold text-white">A1 (B√°sico)</p><p class="text-xs text-slate-400">Conclu√≠do</p></div><label class="custom-checkbox relative flex items-center cursor-pointer"><input type="checkbox" class="level-check save-checkbox sr-only" onchange="updateEnglishLevel('A1')" id="lvl-a1"><div class="w-6 h-6 border-2 border-slate-500 rounded flex items-center justify-center transition-colors"><svg class="w-4 h-4 text-white hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg></div></label></div>
                                <div class="flex items-center justify-between p-3 bg-slate-800/50 rounded-xl border border-slate-700"><div><p class="font-bold text-white">A2 (Elementar)</p><p class="text-xs text-slate-400">Fev - Abr</p></div><label class="custom-checkbox relative flex items-center cursor-pointer"><input type="checkbox" class="level-check save-checkbox sr-only" onchange="updateEnglishLevel('A2')" id="lvl-a2"><div class="w-6 h-6 border-2 border-slate-500 rounded flex items-center justify-center transition-colors"><svg class="w-4 h-4 text-white hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg></div></label></div>
                                <div class="flex items-center justify-between p-3 bg-slate-800/50 rounded-xl border border-slate-700 opacity-80"><div><p class="font-bold text-white">B1 (Intermedi√°rio)</p><p class="text-xs text-slate-400">Mai - Ago</p></div><label class="custom-checkbox relative flex items-center cursor-pointer"><input type="checkbox" class="level-check save-checkbox sr-only" onchange="updateEnglishLevel('B1')" id="lvl-b1"><div class="w-6 h-6 border-2 border-slate-500 rounded flex items-center justify-center transition-colors"><svg class="w-4 h-4 text-white hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg></div></label></div>
                                <div class="flex items-center justify-between p-3 bg-slate-800/50 rounded-xl border border-slate-700 opacity-60"><div><p class="font-bold text-white">B2 (Flu√™ncia)</p><p class="text-xs text-slate-400">Set - Dez</p></div><label class="custom-checkbox relative flex items-center cursor-pointer"><input type="checkbox" class="level-check save-checkbox sr-only" onchange="updateEnglishLevel('B2')" id="lvl-b2"><div class="w-6 h-6 border-2 border-slate-500 rounded flex items-center justify-center transition-colors"><svg class="w-4 h-4 text-white hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg></div></label></div>
                            </div>
                        </div>

                        <!-- Flashcards -->
                        <div class="glass-panel p-6 rounded-2xl flex-1 border border-purple-500/20">
                            <h3 class="font-bold text-white mb-4">Seus Decks</h3>
                            <div id="flashcard-deck-list" class="space-y-3">
                                <div class="p-3 bg-slate-800 rounded-xl border border-slate-700 flex justify-between items-center"><span class="text-slate-300 text-sm">Total Cards</span><span class="text-white font-bold" id="total-cards-count">0</span></div>
                                <button onclick="openFlashcardModal()" class="w-full bg-purple-600 hover:bg-purple-500 text-white py-2 rounded-lg text-sm font-bold transition flex items-center justify-center gap-2"><i class="fa-solid fa-plus"></i> Adicionar Card</button>
                                <button onclick="startFlashcardSession()" class="w-full bg-slate-700 hover:bg-slate-600 text-white py-2 rounded-lg text-sm font-bold transition flex items-center justify-center gap-2"><i class="fa-solid fa-play"></i> Estudar Agora</button>
                            </div>
                            <div id="flashcard-display" class="hidden mt-4 perspective-1000 h-48 relative">
                                <div class="flashcard w-full h-full relative preserve-3d transition-transform duration-500" onclick="this.classList.toggle('flipped')">
                                    <div class="flashcard-front absolute w-full h-full bg-slate-800 border border-purple-500/30 rounded-xl flex flex-col items-center justify-center backface-hidden"><p class="text-xs text-purple-400 uppercase mb-2">English</p><h3 class="text-2xl font-bold text-white" id="fc-front">Word</h3><p class="text-xs text-slate-500 mt-4">(Clique para virar)</p></div>
                                    <div class="flashcard-back absolute w-full h-full bg-purple-900 border border-purple-500 rounded-xl flex flex-col items-center justify-center backface-hidden rotate-y-180"><p class="text-xs text-purple-200 uppercase mb-2">Portugu√™s</p><h3 class="text-2xl font-bold text-white" id="fc-back">Palavra</h3><div class="flex gap-2 mt-4"><button onclick="nextCard(event)" class="px-3 py-1 bg-red-500 rounded text-xs text-white">Dif√≠cil</button><button onclick="nextCard(event)" class="px-3 py-1 bg-green-500 rounded text-xs text-white">F√°cil</button></div></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Right: Audio Chat -->
                    <div class="lg:col-span-8 flex flex-col gap-4">
                        <div class="glass-panel p-6 rounded-2xl flex-1 flex flex-col bg-slate-950/50 h-[500px] relative overflow-hidden">
                            <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-purple-500 to-pink-500"></div>
                            <div class="flex items-center justify-between mb-4 pb-4 border-b border-white/5">
                                <div class="flex items-center gap-3"><img src="https://ui-avatars.com/api/?name=Teacher+AI&background=7c3aed&color=fff" class="w-12 h-12 rounded-full border-2 border-purple-500"><div><h3 class="font-bold text-white">Prof. Gemini (Audio)</h3><p class="text-xs text-purple-400">Conversation Mode: ON</p></div></div>
                                <div id="listening-indicator" class="hidden"><div class="listening-wave"><span></span><span></span><span></span></div><span class="text-xs text-red-400 ml-2 font-bold">Ouvindo...</span></div>
                            </div>
                            <div id="teacher-messages" class="flex-1 overflow-y-auto space-y-4 pr-2 pb-4"><div class="flex gap-3"><img src="https://ui-avatars.com/api/?name=Teacher+AI&background=7c3aed&color=fff" class="w-8 h-8 rounded-full self-end mb-1"><div class="teacher-bubble-ai p-3 text-sm">Hello Luan! Press the mic to practice. üéôÔ∏è</div></div></div>
                            <div class="mt-4 flex gap-2 relative items-center"><button onclick="toggleMic()" id="mic-btn" class="w-12 h-12 rounded-full bg-slate-800 hover:bg-red-500 text-white transition flex items-center justify-center border border-slate-700 hover:border-red-400 shadow-lg group"><i class="fa-solid fa-microphone text-xl group-hover:animate-pulse"></i></button><input type="text" id="teacher-input" class="flex-1 bg-slate-900 border border-slate-700 rounded-xl px-4 py-3 text-sm text-white focus:border-purple-500 outline-none shadow-inner" placeholder="Type or speak..." onkeypress="handleTeacherEnter(event)"><button onclick="sendToTeacher()" class="bg-purple-600 hover:bg-purple-500 text-white p-3 rounded-xl transition shadow-lg shadow-purple-500/20"><i class="fa-solid fa-paper-plane"></i></button></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ================= VIEW: ROUTINE ================= -->
            <div id="view-routine" class="view-section hidden fade-in">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
                    <div><h2 class="text-3xl font-bold text-white">Cronograma Semanal</h2><p class="text-slate-400 text-sm">Alta Performance & Biohacking</p></div>
                    <div class="flex gap-2 items-center bg-slate-800 p-2 rounded-xl border border-slate-700">
                        <input type="text" id="calendar-link-input" placeholder="Embed URL da Agenda..." class="bg-slate-900 border border-slate-600 rounded-lg px-3 py-2 text-xs text-white outline-none w-48 focus:border-blue-500">
                        <button onclick="saveCalendarLink()" class="bg-blue-600 hover:bg-blue-500 text-white px-3 py-2 rounded-lg text-xs font-bold transition">Salvar</button>
                        <button onclick="removeCalendarLink()" id="remove-cal-btn" class="hidden bg-red-600 hover:bg-red-500 text-white px-3 py-2 rounded-lg text-xs font-bold transition"><i class="fa-solid fa-trash"></i></button>
                    </div>
                </div>
                <div id="calendar-container" class="hidden w-full h-[600px] mb-8 glass-panel rounded-2xl overflow-hidden border border-white/10"><iframe id="calendar-frame" src="" style="border: 0" width="100%" height="100%" frameborder="0" scrolling="no"></iframe></div>
                <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
                    <div class="lg:col-span-3">
                        <div class="schedule-grid">
                            <div class="schedule-header">Hora</div><div class="schedule-header">Seg</div><div class="schedule-header">Ter</div><div class="schedule-header">Qua</div><div class="schedule-header">Qui</div><div class="schedule-header">Sex</div>
                            <div class="schedule-time">06:00</div><div class="schedule-cell"><div class="event-block evt-english">üá∫üá∏ Ingl√™s</div></div><div class="schedule-cell"><div class="event-block evt-english">üá∫üá∏ Ingl√™s</div></div><div class="schedule-cell"><div class="event-block evt-english">üá∫üá∏ Ingl√™s</div></div><div class="schedule-cell"><div class="event-block evt-english">üá∫üá∏ Ingl√™s</div></div><div class="schedule-cell"><div class="event-block evt-english">üá∫üá∏ Ingl√™s</div></div>
                            <div class="schedule-time">07:00</div><div class="schedule-cell"><div class="event-block evt-health">üèãÔ∏è Treino</div></div><div class="schedule-cell"><div class="event-block evt-health">üèãÔ∏è Treino</div></div><div class="schedule-cell"><div class="event-block evt-health">üèãÔ∏è Treino</div></div><div class="schedule-cell"><div class="event-block evt-health">üèãÔ∏è Treino</div></div><div class="schedule-cell"><div class="event-block evt-health">üèãÔ∏è Treino</div></div>
                            <div class="schedule-time">08:00</div><div class="schedule-cell"><div class="text-xs text-slate-500 p-1">Banho/Caf√©</div></div><div class="schedule-cell"><div class="text-xs text-slate-500 p-1">Banho/Caf√©</div></div><div class="schedule-cell"><div class="text-xs text-slate-500 p-1">Banho/Caf√©</div></div><div class="schedule-cell"><div class="text-xs text-slate-500 p-1">Banho/Caf√©</div></div><div class="schedule-cell"><div class="text-xs text-slate-500 p-1">Banho/Caf√©</div></div>
                            <div class="schedule-time">09:00</div><div class="schedule-cell row-span-4" style="grid-row: span 4;"><div class="event-block evt-v4 h-full">üöÄ V4 (Operacional)</div></div><div class="schedule-cell row-span-4" style="grid-row: span 4;"><div class="event-block evt-v4 h-full">üöÄ V4 (Operacional)</div></div><div class="schedule-cell row-span-4" style="grid-row: span 4;"><div class="event-block evt-v4 h-full">üöÄ V4 (Operacional)</div></div><div class="schedule-cell row-span-4" style="grid-row: span 4;"><div class="event-block evt-v4 h-full">üöÄ V4 (Operacional)</div></div><div class="schedule-cell row-span-4" style="grid-row: span 4;"><div class="event-block evt-v4 h-full">üöÄ V4 (Operacional)</div></div>
                            <div class="schedule-time">10:00</div><div class="hidden"></div><div class="hidden"></div><div class="hidden"></div><div class="hidden"></div><div class="hidden"></div>
                            <div class="schedule-time">11:00</div><div class="hidden"></div><div class="hidden"></div><div class="hidden"></div><div class="hidden"></div><div class="hidden"></div>
                            <div class="schedule-time">12:00</div><div class="hidden"></div><div class="hidden"></div><div class="hidden"></div><div class="hidden"></div><div class="hidden"></div>
                            <div class="schedule-time">13:00</div><div class="schedule-cell"><div class="event-block evt-health opacity-70">üçΩÔ∏è Almo√ßo</div></div><div class="schedule-cell"><div class="event-block evt-health opacity-70">üçΩÔ∏è Almo√ßo</div></div><div class="schedule-cell"><div class="event-block evt-health opacity-70">üçΩÔ∏è Almo√ßo</div></div><div class="schedule-cell"><div class="event-block evt-health opacity-70">üçΩÔ∏è Almo√ßo</div></div><div class="schedule-cell"><div class="event-block evt-health opacity-70">üçΩÔ∏è Almo√ßo</div></div>
                            <div class="schedule-time">14:00</div><div class="schedule-cell row-span-4" style="grid-row: span 4;"><div class="event-block evt-v4 h-full">üìä V4 (Calls/Otim)</div></div><div class="schedule-cell row-span-4" style="grid-row: span 4;"><div class="event-block evt-v4 h-full">üìä V4 (Calls/Otim)</div></div><div class="schedule-cell row-span-4" style="grid-row: span 4;"><div class="event-block evt-v4 h-full">üìä V4 (Calls/Otim)</div></div><div class="schedule-cell row-span-4" style="grid-row: span 4;"><div class="event-block evt-v4 h-full">üìä V4 (Calls/Otim)</div></div><div class="schedule-cell row-span-4" style="grid-row: span 4;"><div class="event-block evt-v4 h-full">üç∫ Off</div></div>
                            <div class="schedule-time">15:00</div><div class="hidden"></div><div class="hidden"></div><div class="hidden"></div><div class="hidden"></div><div class="hidden"></div>
                            <div class="schedule-time">16:00</div><div class="hidden"></div><div class="hidden"></div><div class="hidden"></div><div class="hidden"></div><div class="hidden"></div>
                            <div class="schedule-time">17:00</div><div class="hidden"></div><div class="hidden"></div><div class="hidden"></div><div class="hidden"></div><div class="hidden"></div>
                            <div class="schedule-time">18:00</div><div class="schedule-cell"></div><div class="schedule-cell"></div><div class="schedule-cell"></div><div class="schedule-cell"></div><div class="schedule-cell"></div>
                            <div class="schedule-time">19:00</div><div class="schedule-cell"><div class="event-block evt-study">üéì Estudo</div></div><div class="schedule-cell"><div class="event-block evt-freela">üí∞ Freela</div></div><div class="schedule-cell"><div class="event-block evt-study">üéì Estudo</div></div><div class="schedule-cell"><div class="event-block evt-freela">üí∞ Freela</div></div><div class="schedule-cell"></div>
                        </div>
                    </div>
                    <div class="lg:col-span-1 space-y-6">
                        <div class="glass-panel p-4 rounded-xl border-l-4 border-red-500 bg-red-900/10">
                            <h4 class="font-bold text-red-400 text-xs uppercase mb-2 flex items-center gap-2"><i class="fa-solid fa-stopwatch"></i> Focus Timer</h4>
                            <div class="text-center"><p id="timer-display" class="text-3xl font-mono font-bold text-white mb-2">25:00</p><div class="flex gap-2 justify-center"><button onclick="toggleTimer()" id="timer-btn" class="bg-red-600 hover:bg-red-500 text-white w-8 h-8 rounded-full flex items-center justify-center"><i class="fa-solid fa-play text-xs"></i></button><button onclick="resetTimer()" class="bg-slate-700 hover:bg-slate-600 text-slate-300 w-8 h-8 rounded-full flex items-center justify-center"><i class="fa-solid fa-rotate-right text-xs"></i></button></div></div>
                        </div>
                        <div class="glass-panel p-4 rounded-xl border border-green-500/20 bg-green-900/10"><h4 class="font-bold text-green-400 text-xs uppercase mb-2 flex items-center gap-2"><i class="fa-solid fa-dna"></i> Biohack do Dia</h4><p class="text-sm text-slate-200" id="daily-biohack">Carregando dica...</p></div>
                        <div class="glass-panel p-4 rounded-xl"><h4 class="font-bold text-white text-sm mb-3">Protocolo Di√°rio</h4><div class="space-y-2" id="protocol-list"></div></div>
                    </div>
                </div>
            </div>

        </div>
    </main>

    <!-- AI HUB & MODALS -->
    <div class="fixed bottom-8 right-8 z-50 flex flex-col items-end">
        <div id="ai-chat-window" class="hidden w-80 md:w-96 bg-slate-900 border border-slate-700 rounded-2xl shadow-2xl mb-4 overflow-hidden flex flex-col h-[500px] transition-all theme-tutor">
            <div class="bg-slate-800 p-3 border-b border-slate-700">
                <div class="flex bg-slate-900 rounded-lg p-1 mb-2"><button onclick="setAIMode('tutor')" id="btn-mode-tutor" class="flex-1 py-1.5 text-xs font-bold rounded-md bg-slate-700 text-white shadow">üá∫üá∏ Tutor</button><button onclick="setAIMode('coach')" id="btn-mode-coach" class="flex-1 py-1.5 text-xs font-bold rounded-md text-slate-400">üß† Coach</button></div>
                <div class="flex justify-between items-center px-1"><div class="flex items-center gap-2"><span id="ai-name" class="text-sm font-bold text-white">English Teacher</span></div><button onclick="toggleChat()" class="text-slate-400"><i class="fa-solid fa-times"></i></button></div>
            </div>
            <div id="chat-messages" class="flex-1 p-4 overflow-y-auto space-y-4 bg-slate-950"><div class="chat-bubble-ai p-3 text-sm">Hello Luan! üá∫üá∏</div></div>
            <div class="p-3 bg-slate-800 border-t border-slate-700"><div class="relative flex gap-2"><input type="text" id="chat-input" class="w-full bg-slate-900 text-slate-200 text-sm rounded-lg pl-3 pr-10 py-2 border border-slate-700 outline-none" onkeypress="handleChatEnter(event)"><button onclick="handleChatMessage()" class="text-blue-500 p-2"><i class="fa-solid fa-paper-plane"></i></button></div></div>
        </div>
        <button onclick="toggleChat()" class="w-16 h-16 rounded-full bg-gradient-to-r from-blue-600 to-indigo-600 shadow-[0_0_20px_rgba(37,99,235,0.5)] flex items-center justify-center text-white text-2xl hover:scale-110 transition-transform border border-white/20"><i class="fa-solid fa-robot"></i></button>
    </div>

    <!-- MODAL: CLIENT -->
    <div id="client-modal" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-[60] hidden flex items-center justify-center p-4">
        <div class="bg-slate-900 border border-slate-700 rounded-2xl w-full max-w-md p-6 relative">
            <h3 class="text-xl font-bold text-white mb-4">Novo Cliente</h3>
            <form id="client-form" class="space-y-3">
                <input type="text" id="c-name" class="w-full bg-slate-800 border border-slate-700 rounded-lg p-3 text-white" placeholder="Nome" required>
                <div class="grid grid-cols-2 gap-3"><input type="number" id="c-value" class="w-full bg-slate-800 border-slate-700 rounded-lg p-3 text-white" placeholder="Valor" required><input type="date" id="c-start" class="w-full bg-slate-800 border-slate-700 rounded-lg p-3 text-white" required></div>
                <input type="number" id="c-day" class="w-full bg-slate-800 border-slate-700 rounded-lg p-3 text-white" placeholder="Dia Pagamento">
                <div class="flex gap-2 pt-2"><button type="button" onclick="document.getElementById('client-modal').classList.add('hidden')" class="flex-1 py-2 text-slate-400">Cancelar</button><button type="submit" class="flex-1 bg-yellow-500 text-slate-900 font-bold py-2 rounded-lg">Salvar</button></div>
            </form>
        </div>
    </div>

    <!-- MODAL: FLASHCARD -->
    <div id="flashcard-modal" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-[60] hidden flex items-center justify-center p-4">
        <div class="bg-slate-900 border border-slate-700 rounded-2xl w-full max-w-md p-6 relative">
            <h3 class="text-xl font-bold text-white mb-4">Adicionar Flashcard</h3>
            <div class="space-y-3">
                <input type="text" id="fc-input-front" class="w-full bg-slate-800 border border-slate-700 rounded-lg p-3 text-white" placeholder="Ingl√™s (Front)">
                <input type="text" id="fc-input-back" class="w-full bg-slate-800 border border-slate-700 rounded-lg p-3 text-white" placeholder="Portugu√™s (Back)">
                <div class="flex gap-2 pt-2"><button onclick="document.getElementById('flashcard-modal').classList.add('hidden')" class="flex-1 py-2 text-slate-400">Cancelar</button><button onclick="saveFlashcard()" class="flex-1 bg-purple-500 text-white font-bold py-2 rounded-lg">Salvar</button></div>
            </div>
        </div>
    </div>

    <script>
        const apiKey = "AIzaSyD9aqaHvwwg52ycVzwlnjeQAhHwC0nUkfc"; // COLE SUA API KEY AQUI

        // --- STATE ---
        let appData = { 
            v4Salary: 3700, clients: [], brainDump: "", calendarLink: "", 
            checkboxes: {}, photo: "", journal: "", flashcards: [],
            currentWeight: 90.0, investmentCurrent: 8500.0
        };
        const biohacks = ["Tome 500ml de √°gua logo ao acordar.", "10min de sol pela manh√£.", "Bloqueie notifica√ß√µes 09h-12h.", "Cafe√≠na s√≥ at√© as 14h.", "Regra dos 2 minutos: fa√ßa agora.", "Banho gelado aumenta dopamina.", "Caminhada p√≥s-almo√ßo reduz glicose."];
        const protocols = [
            {id: "p1", txt: "üíß 3L √Ågua"}, {id: "p2", txt: "üìñ 10 Pag Leitura"}, {id: "p3", txt: "üèãÔ∏è Treino Feito"}, {id: "p4", txt: "üö´ Zero A√ß√∫car"},
            {id: "p5", txt: "üßò 5min Sil√™ncio"}, {id: "p6", txt: "üìµ Sem celular ao acordar"}
        ];

        // --- PERSISTENCE ---
        function saveData() { localStorage.setItem('luanos_v6', JSON.stringify(appData)); }
        function loadData() {
            const saved = localStorage.getItem('luanos_v6');
            if (saved) {
                appData = JSON.parse(saved);
                updateFinancials();
                document.getElementById('brain-dump').value = appData.brainDump || "";
                document.getElementById('planning-journal').value = appData.journal || "";
                if(appData.calendarLink) showCalendar(appData.calendarLink);
                if(appData.photo) {
                    const imgEl = document.getElementById('user-photo');
                    if(imgEl) { imgEl.src = appData.photo; imgEl.classList.remove('hidden'); document.getElementById('user-initial').classList.add('hidden'); }
                }
                Object.keys(appData.checkboxes).forEach(id => { const el = document.getElementById(id); if(el) el.checked = appData.checkboxes[id]; });
                calculatePromotion(); 
                updateFlashcardUI();
            }
            updateDailyContent();
        }

        function addSafeListener(id, event, handler) { const el = document.getElementById(id); if (el) el.addEventListener(event, handler); }

        // --- DAILY CONTENT ROTATION ---
        function updateDailyContent() {
            document.getElementById('daily-biohack').innerText = biohacks[new Date().getDate() % biohacks.length];
            const list = document.getElementById('protocol-list');
            list.innerHTML = "";
            const todaysProtocol = protocols[new Date().getDate() % protocols.length];
            [0,1,2].forEach(i => {
                const p = protocols[i];
                list.innerHTML += `<label class="flex items-center gap-2 cursor-pointer group"><input type="checkbox" class="save-checkbox w-4 h-4 rounded border-slate-600 bg-slate-800 text-blue-500" id="${p.id}"><span class="text-xs text-slate-300 group-hover:text-white transition">${p.txt}</span></label>`;
            });
            if(![0,1,2].includes(protocols.indexOf(todaysProtocol))) {
                 list.innerHTML += `<label class="flex items-center gap-2 cursor-pointer group"><input type="checkbox" class="save-checkbox w-4 h-4 rounded border-slate-600 bg-slate-800 text-blue-500" id="${todaysProtocol.id}"><span class="text-xs text-slate-300 group-hover:text-white transition font-bold text-yellow-400">${todaysProtocol.txt} (Extra)</span></label>`;
            }
            Object.keys(appData.checkboxes).forEach(id => { const el = document.getElementById(id); if(el) el.checked = appData.checkboxes[id]; });
        }

        // --- V4 PROMOTION ---
        function calculatePromotion() {
            const certs = document.querySelectorAll('.cert-check');
            let checked = 0; certs.forEach(c => { if(c.checked) checked++; });
            const total = certs.length;
            const pct = Math.round((checked / total) * 100);
            document.getElementById('promo-pct-text').innerText = `${pct}%`;
            document.getElementById('promo-pct-bar').style.width = `${pct}%`;
        }

        // --- FLASHCARDS ---
        let currentCardIndex = 0;
        function openFlashcardModal() { document.getElementById('flashcard-modal').classList.remove('hidden'); }
        function saveFlashcard() {
            const front = document.getElementById('fc-input-front').value;
            const back = document.getElementById('fc-input-back').value;
            if(front && back) {
                appData.flashcards.push({front, back}); saveData();
                document.getElementById('fc-input-front').value = ""; document.getElementById('fc-input-back').value = "";
                document.getElementById('flashcard-modal').classList.add('hidden'); updateFlashcardUI();
            }
        }
        function updateFlashcardUI() { document.getElementById('total-cards-count').innerText = appData.flashcards.length; }
        function startFlashcardSession() {
            if(appData.flashcards.length === 0) return alert("Adicione cards primeiro!");
            document.getElementById('flashcard-display').classList.remove('hidden'); showCard(0);
        }
        function showCard(index) {
            currentCardIndex = index; if(index >= appData.flashcards.length) currentCardIndex = 0;
            const card = appData.flashcards[currentCardIndex];
            document.getElementById('fc-front').innerText = card.front;
            document.getElementById('fc-back').innerText = card.back;
            document.querySelector('.flashcard').classList.remove('flipped');
        }
        function nextCard(e) { e.stopPropagation(); showCard(currentCardIndex + 1); }

        // --- PHOTO & CALENDAR ---
        function uploadPhoto(input) { if (input.files && input.files[0]) { const r = new FileReader(); r.onload = function(e) { appData.photo = e.target.result; const img = document.getElementById('user-photo'); if(img){img.src=e.target.result; img.classList.remove('hidden'); document.getElementById('user-initial').classList.add('hidden'); saveData();} }; r.readAsDataURL(input.files[0]); } }
        function saveCalendarLink() { const link = document.getElementById('calendar-link-input').value; appData.calendarLink = link; saveData(); showCalendar(link); }
        function showCalendar(link) { if(!link) return; const c = document.getElementById('calendar-container'); document.getElementById('calendar-frame').src = link; c.classList.remove('hidden'); document.getElementById('calendar-link-input').parentElement.classList.add('hidden'); document.getElementById('remove-cal-btn').classList.remove('hidden'); }
        function removeCalendarLink() { appData.calendarLink = ""; saveData(); document.getElementById('calendar-container').classList.add('hidden'); document.getElementById('calendar-link-input').parentElement.classList.remove('hidden'); document.getElementById('remove-cal-btn').classList.add('hidden'); document.getElementById('calendar-link-input').value = ""; }

        // --- FINANCIALS ---
        let financeChart;
        function initChart() {
            const ctxF = document.getElementById('financeChart').getContext('2d');
            financeChart = new Chart(ctxF, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'],
                    datasets: [
                        { label: 'Realidade (Run Rate)', data: [], borderColor: '#3b82f6', backgroundColor: 'rgba(59, 130, 246, 0.1)', fill: true, tension: 0.4 },
                        { label: 'Meta V4', data: [3700, 4200, 4200, 4200, 4700, 4700, 4700, 4700, 5350, 5350, 5350, 6000], borderColor: '#ef4444', borderDash: [5,5], tension: 0.4 },
                        { label: 'Meta Freela', data: [0, 0, 0, 1000, 1500, 1500, 2000, 2000, 3000, 3000, 3000, 3000], borderColor: '#eab308', borderDash: [5,5], tension: 0.4 },
                        { label: 'Meta Total', data: [3700, 4200, 4200, 5200, 6200, 6200, 6700, 6700, 8350, 8350, 8350, 9000], borderColor: '#64748b', borderWidth: 1, borderDash: [2,2], tension: 0.4 }
                    ]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: true, labels: { color: '#94a3b8', font: {size: 10} } } }, scales: { y: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#64748b' } }, x: { grid: { display: false }, ticks: { color: '#64748b' } } } }
            });
        }

        function updateFinancials() {
            let freelaMRR = 0; let freelaLTV = 0;
            const now = new Date(); let clientCount = 0;
            appData.clients.forEach(c => {
                const val = parseFloat(c.value);
                freelaMRR += val; clientCount++;
                if(c.startDate) {
                    const start = new Date(c.startDate);
                    let months = (now.getFullYear() - start.getFullYear()) * 12;
                    months -= start.getMonth(); months += now.getMonth();
                    freelaLTV += val * (months <= 0 ? 1 : months + 1);
                } else { freelaLTV += val; }
            });

            if(document.getElementById('crm-mrr')) document.getElementById('crm-mrr').innerText = `R$ ${freelaMRR.toLocaleString('pt-BR')}`;
            if(document.getElementById('crm-ltv')) document.getElementById('crm-ltv').innerText = `R$ ${freelaLTV.toLocaleString('pt-BR')}`;
            const avgTicket = clientCount > 0 ? (freelaMRR / clientCount) : 0;
            if(document.getElementById('crm-avg-ticket')) document.getElementById('crm-avg-ticket').innerText = `R$ ${avgTicket.toLocaleString('pt-BR')}`;

            let totalIncome = appData.v4Salary + freelaMRR;
            if(document.getElementById('main-total-income')) document.getElementById('main-total-income').innerText = `R$ ${totalIncome.toLocaleString('pt-BR')}`;
            if(document.getElementById('dash-v4-current-mini')) document.getElementById('dash-v4-current-mini').innerText = `R$ ${appData.v4Salary.toLocaleString('pt-BR')}`;
            
            // Dashboard Progress
            const goal = 9000;
            const pct = Math.min((totalIncome / goal) * 100, 100);
            const pctText = Math.round(pct) + '%';
            document.getElementById('main-progress-pct').innerText = pctText;
            document.getElementById('main-progress-bar').style.width = pctText;
            document.getElementById('global-progress-text').innerText = pctText;
            document.getElementById('global-progress-bar').style.width = pctText;

            // Chart: Run Rate Projection
            const flatReality = Array(12).fill(totalIncome);
            if(financeChart) { financeChart.data.datasets[0].data = flatReality; financeChart.update(); }
            
            renderClientCards();
            
            // Freela Bar in Freela Tab
            const freelaGoal = 3000;
            const fPct = Math.min((freelaMRR/freelaGoal)*100, 100) + '%';
            if(document.getElementById('freela-goal-bar')) document.getElementById('freela-goal-bar').style.width = fPct;
        }

        function renderClientCards() {
            const container = document.getElementById('clients-container');
            if(!container) return;
            container.innerHTML = '';
            if (appData.clients.length === 0) { container.innerHTML = `<div class="col-span-full py-12 text-center border-2 border-dashed border-slate-800 rounded-3xl opacity-50"><i class="fa-solid fa-folder-open text-4xl mb-4 text-slate-600"></i><p class="text-slate-400">Nenhum contrato ativo.</p></div>`; return; }
            appData.clients.forEach((client, index) => {
                const card = document.createElement('div');
                card.className = 'glass-panel p-6 rounded-3xl relative group';
                card.innerHTML = `<div class="flex justify-between items-start mb-4"><div class="w-12 h-12 rounded-xl bg-gradient-to-br from-yellow-500 to-orange-500 flex items-center justify-center text-white text-xl font-bold shadow-lg shadow-orange-500/20">${client.name.charAt(0)}</div><button onclick="removeClient(${index})" class="text-slate-600 hover:text-red-500 transition"><i class="fa-solid fa-trash"></i></button></div><h4 class="text-xl font-bold text-white mb-1">${client.name}</h4><p class="text-2xl font-bold text-green-400 mb-4">R$ ${parseFloat(client.value).toLocaleString('pt-BR')}</p><div class="flex items-center gap-2 text-sm text-slate-400 bg-slate-800/50 p-2 rounded-lg"><i class="fa-regular fa-calendar text-yellow-500"></i><span>Dia ${client.day}</span></div>`;
                container.appendChild(card);
            });
        }

        function removeClient(index) { if(confirm("Encerrar contrato?")) { appData.clients.splice(index, 1); saveData(); updateFinancials(); } }
        function openClientModal() { document.getElementById('client-modal').classList.remove('hidden'); }
        addSafeListener('client-form', 'submit', (e) => {
            e.preventDefault();
            const newClient = { name: document.getElementById('c-name').value, value: document.getElementById('c-value').value, day: document.getElementById('c-day').value, startDate: document.getElementById('c-start').value };
            appData.clients.push(newClient); saveData(); document.getElementById('client-modal').classList.add('hidden'); e.target.reset(); updateFinancials();
        });

        // --- V4 ---
        function updateV4Salary(newAmount, btn) {
            appData.v4Salary = newAmount; saveData(); updateFinancials();
            btn.innerText = "Ativo"; btn.disabled = true; btn.className = "mt-2 text-xs bg-green-500/10 text-green-400 px-3 py-1 rounded cursor-default";
            if(document.getElementById('v4-salary-display')) document.getElementById('v4-salary-display').innerText = `R$ ${newAmount.toLocaleString('pt-BR')}`;
        }

        // --- GENERAL ---
        function addInvestment() {
            const amountStr = prompt("Valor do novo aporte (R$):", "0");
            if(amountStr) { const val = parseFloat(amountStr.replace(',', '.')); if(!isNaN(val)) { appData.investmentCurrent += val; saveData(); updateInvestmentDisplay(); } }
        }
        function updateInvestmentDisplay() {
            document.getElementById('inv-current').innerText = `R$ ${appData.investmentCurrent.toLocaleString('pt-BR')}`;
            const pct = Math.min((appData.investmentCurrent / 22000) * 100, 100);
            document.getElementById('inv-pct').innerText = Math.round(pct) + '%';
            document.getElementById('inv-bar').style.width = pct + '%';
        }
        function updateEnglishLevel(lvl) {
            if(document.getElementById('dash-english-lvl')) document.getElementById('dash-english-lvl').innerText = lvl;
            // Also ensure checkboxes in English tab reflect stored state if updated from elsewhere (not needed for simple flow)
        }
        function adjustWeight(amount) {
            appData.currentWeight += amount; appData.currentWeight = Math.round(appData.currentWeight * 10) / 10; saveData();
            document.getElementById('current-weight').innerText = appData.currentWeight.toFixed(1);
            const totalLoss = 90.0 - appData.currentWeight;
            document.getElementById('weight-bar').style.width = `${Math.max(0, Math.min((totalLoss/20)*100, 100))}%`;
            document.getElementById('weight-lost').innerText = `${totalLoss.toFixed(1)}kg eliminados`;
        }

        // --- AI ---
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        let recognition;
        if (SpeechRecognition) {
            recognition = new SpeechRecognition(); recognition.lang = 'en-US';
            recognition.onstart = () => { document.getElementById('listening-indicator').classList.remove('hidden'); };
            recognition.onend = () => { document.getElementById('listening-indicator').classList.add('hidden'); };
            recognition.onresult = (e) => { document.getElementById('teacher-input').value = e.results[0][0].transcript; sendToTeacher(); };
        }
        function toggleMic() { if(recognition) recognition.start(); else alert("Navegador n√£o suportado."); }
        async function callGemini(text, mode) {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            const prompt = mode === 'tutor' ? `Act as an English Tutor for A1 student. User: "${text}". Reply nicely.` : `Strategic Coach. User: "${text}". Reply in PT-BR.`;
            try {
                const response = await fetch(url, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ contents: [{ parts: [{ text: text }] }], systemInstruction: { parts: [{ text: prompt }] } }) });
                const data = await response.json(); return data.candidates[0].content.parts[0].text;
            } catch (e) { return "Erro API."; }
        }
        async function sendToTeacher() {
            const input = document.getElementById('teacher-input'); const text = input.value; if(!text) return;
            const msgs = document.getElementById('teacher-messages'); msgs.innerHTML += `<div class="flex gap-3 justify-end"><div class="teacher-bubble-user p-3 text-sm">${text}</div></div>`; input.value = '';
            const resp = await callGemini(text, 'tutor');
            msgs.innerHTML += `<div class="flex gap-3"><img src="https://ui-avatars.com/api/?name=Teacher+AI&background=7c3aed&color=fff" class="w-8 h-8 rounded-full self-end mb-1"><div class="teacher-bubble-ai p-3 text-sm">${marked.parse(resp)}</div></div>`;
            msgs.scrollTop = msgs.scrollHeight;
            const u = new SpeechSynthesisUtterance(resp); u.lang = 'en-US'; window.speechSynthesis.speak(u);
        }
        function handleTeacherEnter(e) { if(e.key === 'Enter') sendToTeacher(); }
        // Chat Hub Logic
        let aiMode = 'tutor';
        function toggleChat() { document.getElementById('ai-chat-window').classList.toggle('hidden'); }
        function setAIMode(mode) {
            aiMode = mode;
            const msgs = document.getElementById('chat-messages'); msgs.innerHTML = '';
            if (mode === 'tutor') { msgs.innerHTML = '<div class="chat-bubble-ai p-3 text-sm">Hello Luan! üá∫üá∏</div>'; document.getElementById('ai-name').innerText = "English Teacher"; }
            else { msgs.innerHTML = '<div class="chat-bubble-ai p-3 text-sm">Ol√°, Luan! Vamos falar de estrat√©gia? üß†</div>'; document.getElementById('ai-name').innerText = "Strategic Coach"; }
        }
        async function handleChatMessage() {
            const input = document.getElementById('chat-input'); const text = input.value; if(!text) return;
            const msgs = document.getElementById('chat-messages'); msgs.innerHTML += `<div class="flex justify-end"><div class="chat-bubble-user p-3 text-sm">${text}</div></div>`; input.value = '';
            const resp = await callGemini(text, aiMode);
            msgs.innerHTML += `<div class="flex"><div class="chat-bubble-ai p-3 text-sm prose prose-invert max-w-none">${marked.parse(resp)}</div></div>`; msgs.scrollTop = msgs.scrollHeight;
        }
        function handleChatEnter(e) { if(e.key === 'Enter') handleChatMessage(); }

        // --- TIMER ---
        let timerInterval; let timeLeft = 25 * 60; let isRunning = false;
        function updateTimerDisplay() {
            const m = Math.floor(timeLeft / 60).toString().padStart(2, '0');
            const s = (timeLeft % 60).toString().padStart(2, '0');
            const el = document.getElementById('timer-display'); if(el) el.innerText = `${m}:${s}`;
        }
        function toggleTimer() {
            const btn = document.getElementById('timer-btn');
            if (isRunning) { clearInterval(timerInterval); btn.innerHTML = '<i class="fa-solid fa-play text-xs"></i>'; isRunning = false; }
            else { btn.innerHTML = '<i class="fa-solid fa-pause text-xs"></i>'; isRunning = true; timerInterval = setInterval(() => { if (timeLeft > 0) { timeLeft--; updateTimerDisplay(); } else { clearInterval(timerInterval); isRunning = false; alert("Foco conclu√≠do!"); } }, 1000); }
        }
        function resetTimer() { clearInterval(timerInterval); timeLeft = 25 * 60; updateTimerDisplay(); isRunning = false; document.getElementById('timer-btn').innerHTML = '<i class="fa-solid fa-play text-xs"></i>'; }

        // --- GLOBAL ---
        function switchTab(id) { document.querySelectorAll('.view-section').forEach(el => el.classList.add('hidden')); document.getElementById('view-'+id).classList.remove('hidden'); }
        document.addEventListener('change', (e) => { if(e.target.classList.contains('save-checkbox')) { appData.checkboxes[e.target.id] = e.target.checked; saveData(); if(e.target.classList.contains('cert-check')) calculatePromotion(); } });
        addSafeListener('planning-journal', 'input', (e) => { appData.journal = e.target.value; saveData(); });
        addSafeListener('brain-dump', 'input', (e) => { appData.brainDump = e.target.value; saveData(); });

        // Init
        document.addEventListener('DOMContentLoaded', () => {
            initChart();
            loadData();
            const ctxD = document.getElementById('incomeDistChart').getContext('2d');
            new Chart(ctxD, { type: 'doughnut', data: { labels: ['V4', 'Freela'], datasets: [{ data: [3700, 0], backgroundColor: ['#ef4444', '#eab308'], borderWidth: 0 }] }, options: { plugins: { legend: { display: false } }, cutout: '75%' } });
            setAIMode('tutor');
        });
    </script>
</body>
</html>
