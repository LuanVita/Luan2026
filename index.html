<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LuanOS 4.0 | AI Strategic Hub</title>
    
    <!-- Bibliotecas -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap');
        
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: #020617;
            color: #f8fafc;
            overflow: hidden;
        }

        .glass-panel {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
        }
        
        /* Scrollbar */
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
        
        /* Anima√ß√µes */
        .card-hover { transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1); }
        .card-hover:hover { transform: translateY(-4px); border-color: rgba(255,255,255,0.2); }
        .fade-in { animation: fadeIn 0.4s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Audio Visualizer Animation */
        .listening-wave {
            display: inline-flex; align-items: center; gap: 2px; height: 16px;
        }
        .listening-wave span {
            width: 3px; height: 100%; background: #ef4444; border-radius: 2px;
            animation: wave 1s infinite ease-in-out;
        }
        .listening-wave span:nth-child(2) { animation-delay: 0.1s; }
        .listening-wave span:nth-child(3) { animation-delay: 0.2s; }
        @keyframes wave { 0%, 100% { height: 4px; } 50% { height: 16px; } }

        /* Custom Checkbox Logic */
        .custom-checkbox input:checked + div { 
            background-color: #22c55e; 
            border-color: #22c55e; 
        }
        .custom-checkbox input:checked + div svg { 
            display: block; 
        }

        /* Chat Styles */
        .chat-bubble-ai { background: rgba(30, 41, 59, 0.8); border: 1px solid rgba(255, 255, 255, 0.1); color: #e2e8f0; border-radius: 12px 12px 12px 0; max-width: 85%; }
        .chat-bubble-user { background: #3b82f6; color: white; border-radius: 12px 12px 0 12px; max-width: 85%; }
        
        /* Coach Theme */
        .theme-coach .chat-bubble-ai { border-color: rgba(16, 185, 129, 0.3); background: rgba(6, 78, 59, 0.4); }
        .theme-coach .chat-bubble-user { background: #059669; }
        
        /* Tutor Theme */
        .theme-tutor .chat-bubble-ai { border-color: rgba(139, 92, 246, 0.3); background: rgba(76, 29, 149, 0.4); }
        .theme-tutor .chat-bubble-user { background: #7c3aed; }

        /* Timeline */
        .timeline-line { position: absolute; left: 28px; top: 20px; bottom: 20px; width: 2px; background: linear-gradient(to bottom, #22c55e 0%, #334155 100%); z-index: 0; }
        
        /* Schedule Grid Styling */
        .schedule-grid {
            display: grid;
            grid-template-columns: 60px repeat(5, 1fr);
            gap: 1px;
            background-color: rgba(255,255,255,0.05);
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .schedule-header { background-color: rgba(30, 41, 59, 0.8); padding: 10px; text-align: center; font-size: 0.75rem; font-weight: 700; color: #94a3b8; text-transform: uppercase; }
        .schedule-time { padding: 10px; text-align: right; font-size: 0.7rem; color: #64748b; background: rgba(15, 23, 42, 0.4); border-right: 1px solid rgba(255,255,255,0.05); }
        .schedule-cell { background-color: rgba(15, 23, 42, 0.2); min-height: 50px; position: relative; }
        .event-block {
            position: absolute; left: 2px; right: 2px; border-radius: 6px; padding: 4px 8px;
            font-size: 0.7rem; font-weight: 600; color: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            display: flex; flex-direction: column; justify-content: center;
        }
        .evt-english { background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%); border-left: 3px solid #a78bfa; top: 0; bottom: 0; }
        .evt-health { background: linear-gradient(135deg, #059669 0%, #047857 100%); border-left: 3px solid #34d399; top: 0; bottom: 0; }
        .evt-v4 { background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%); border-left: 3px solid #f87171; top: 5px; bottom: 5px; }
        .evt-freela { background: linear-gradient(135deg, #d97706 0%, #b45309 100%); border-left: 3px solid #fbbf24; top: 5px; bottom: 5px; }
    </style>
</head>
<body class="flex h-screen selection:bg-blue-500 selection:text-white">

    <!-- SIDEBAR -->
    <aside class="w-20 lg:w-72 glass-panel border-r-0 flex flex-col justify-between z-50">
        <div class="h-24 flex items-center justify-center lg:justify-start lg:px-8 border-b border-white/5">
            <div class="relative">
                <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-blue-600 to-indigo-600 flex items-center justify-center text-white font-bold text-xl shadow-lg shadow-blue-500/20">L</div>
                <div class="absolute -bottom-1 -right-1 w-3 h-3 bg-green-500 rounded-full border-2 border-slate-900"></div>
            </div>
            <div class="ml-4 hidden lg:block">
                <h1 class="font-bold text-lg tracking-wide text-white">LuanOS <span class="text-[10px] bg-white/10 px-2 py-0.5 rounded-full text-blue-300 font-medium">v4.0</span></h1>
                <p class="text-xs text-slate-400">System Online</p>
            </div>
        </div>

        <nav class="flex-1 px-4 py-8 space-y-2">
            <button onclick="switchTab('dashboard')" id="nav-dashboard" class="nav-btn w-full flex items-center p-3.5 rounded-xl bg-white/10 text-white transition-all group active-nav">
                <i class="fa-solid fa-grid-2 text-xl w-8 text-center text-blue-400"></i>
                <span class="ml-3 font-medium hidden lg:block">Vis√£o Geral</span>
            </button>
            <p class="hidden lg:block px-4 mt-6 mb-2 text-[10px] font-bold text-slate-500 uppercase tracking-widest">√Åreas de Foco</p>
            <button onclick="switchTab('v4')" id="nav-v4" class="nav-btn w-full flex items-center p-3.5 rounded-xl text-slate-400 hover:bg-white/5 hover:text-white transition-all group"><i class="fa-solid fa-building text-xl w-8 text-center group-hover:text-red-400"></i><span class="ml-3 font-medium hidden lg:block">Carreira V4</span></button>
            <button onclick="switchTab('freela')" id="nav-freela" class="nav-btn w-full flex items-center p-3.5 rounded-xl text-slate-400 hover:bg-white/5 hover:text-white transition-all group"><i class="fa-solid fa-briefcase text-xl w-8 text-center group-hover:text-yellow-400"></i><span class="ml-3 font-medium hidden lg:block">Ag√™ncia Freela</span></button>
            <button onclick="switchTab('english')" id="nav-english" class="nav-btn w-full flex items-center p-3.5 rounded-xl text-slate-400 hover:bg-white/5 hover:text-white transition-all group"><i class="fa-solid fa-earth-americas text-xl w-8 text-center group-hover:text-purple-400"></i><span class="ml-3 font-medium hidden lg:block">Jornada Ingl√™s</span></button>
            <button onclick="switchTab('routine')" id="nav-routine" class="nav-btn w-full flex items-center p-3.5 rounded-xl text-slate-400 hover:bg-white/5 hover:text-white transition-all group"><i class="fa-regular fa-calendar-check text-xl w-8 text-center group-hover:text-green-400"></i><span class="ml-3 font-medium hidden lg:block">Rotina</span></button>
        </nav>

        <div class="p-6 border-t border-white/5 hidden lg:block">
            <div class="bg-white/5 rounded-xl p-4 border border-white/5">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-xs text-slate-400 font-semibold">META (9K)</span>
                    <span class="text-xs text-white font-bold" id="global-progress-text">41%</span>
                </div>
                <div class="w-full bg-slate-700 h-1.5 rounded-full overflow-hidden">
                    <div id="global-progress-bar" class="bg-gradient-to-r from-blue-500 to-indigo-500 h-full w-[41%] shadow-[0_0_10px_rgba(59,130,246,0.5)] transition-all duration-1000"></div>
                </div>
            </div>
        </div>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="flex-1 relative overflow-y-auto bg-[url('https://grainy-gradients.vercel.app/noise.svg')] bg-opacity-20">
        
        <header class="h-24 flex items-center justify-between px-8 sticky top-0 z-40 backdrop-blur-sm bg-slate-950/50">
            <div>
                <h2 id="page-title" class="text-2xl font-bold text-white">Dashboard</h2>
                <p class="text-sm text-slate-400 flex items-center gap-2"><span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span> Planejamento 2026 Ativo</p>
            </div>
            <div class="text-right hidden md:block opacity-50 hover:opacity-100 transition">
                <p class="text-[10px] text-slate-400 font-bold uppercase tracking-wider">LuanOS v4.0 AI</p>
            </div>
        </header>

        <div class="p-8 max-w-[1600px] mx-auto pb-32">

            <!-- ================= VIEW: DASHBOARD ================= -->
            <div id="view-dashboard" class="view-section fade-in">
                
                <!-- 1. BARRA DE STATUS FINANCEIRO -->
                <div class="glass-panel p-4 rounded-2xl mb-6 flex items-center justify-between border-l-4 border-blue-500">
                    <div class="flex items-center gap-4">
                        <div class="w-10 h-10 rounded-full bg-blue-500/10 flex items-center justify-center text-blue-400"><i class="fa-solid fa-wallet"></i></div>
                        <div>
                            <p class="text-xs text-slate-400 uppercase font-bold">Renda Mensal Total</p>
                            <div class="flex items-baseline gap-2">
                                <h3 class="text-2xl font-bold text-white" id="main-total-income">R$ 3.700,00</h3>
                                <span class="text-xs text-slate-500">de R$ 9.000,00</span>
                            </div>
                        </div>
                    </div>
                    <div class="flex-1 mx-8 hidden md:block">
                        <div class="flex justify-between text-xs text-slate-400 mb-1">
                            <span>Progresso da Meta</span>
                            <span id="main-progress-pct">41%</span>
                        </div>
                        <div class="w-full bg-slate-800 h-2 rounded-full overflow-hidden">
                            <div id="main-progress-bar" class="bg-gradient-to-r from-blue-500 to-green-400 h-full w-[41%] shadow-[0_0_10px_rgba(59,130,246,0.5)] transition-all duration-1000"></div>
                        </div>
                    </div>
                    <div class="text-right hidden md:block">
                        <span class="text-xs bg-green-500/10 text-green-400 px-2 py-1 rounded border border-green-500/20">Em Crescimento</span>
                    </div>
                </div>

                <!-- 2. CARDS PRINCIPAIS -->
                <div class="grid grid-cols-1 md:grid-cols-4 lg:grid-cols-4 gap-6 mb-6">
                    <!-- V4 Status -->
                    <div class="glass-panel p-6 rounded-3xl col-span-1 md:col-span-2 relative overflow-hidden group card-hover">
                        <div class="absolute top-0 right-0 w-32 h-32 bg-red-500/10 rounded-full blur-[50px] transition group-hover:bg-red-500/20"></div>
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <span class="text-xs font-bold text-red-400 uppercase tracking-widest bg-red-500/10 px-2 py-1 rounded border border-red-500/20">Principal</span>
                                <h3 class="text-3xl font-bold text-white mt-2">V4 Company</h3>
                            </div>
                            <div class="text-right">
                                <p class="text-xs text-slate-400 uppercase">Progresso da Meta</p>
                                <div class="flex items-baseline gap-1 justify-end">
                                    <p class="text-xl font-bold text-white" id="dash-v4-current-mini">R$ 3.700</p>
                                    <span class="text-xs text-slate-500 font-medium">/ R$ 6.000</span>
                                </div>
                            </div>
                        </div>
                        <div class="relative pt-2">
                            <div class="flex justify-between text-xs text-slate-400 mb-2 font-mono">
                                <span>Sal√°rio Atual</span>
                                <span id="dash-v4-pct">61%</span>
                            </div>
                            <div class="w-full bg-slate-800 h-3 rounded-full overflow-hidden">
                                <div id="dash-v4-bar" class="bg-gradient-to-r from-red-600 to-orange-600 h-full w-[61%] transition-all duration-1000"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Income Distribution -->
                    <div class="glass-panel p-6 rounded-3xl col-span-1 relative card-hover flex flex-col justify-between">
                        <div class="flex justify-between items-start mb-2">
                            <p class="text-slate-400 text-xs uppercase font-bold">Mix de Renda</p>
                            <i class="fa-solid fa-chart-pie text-slate-600"></i>
                        </div>
                        <div class="h-32 relative">
                            <canvas id="incomeDistChart"></canvas>
                            <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
                                <span class="text-xs text-slate-500 font-bold">Mix</span>
                            </div>
                        </div>
                    </div>

                    <!-- MINDSET CARD -->
                    <div class="glass-panel p-6 rounded-3xl col-span-1 relative card-hover flex flex-col justify-center items-center text-center bg-gradient-to-br from-indigo-900/40 to-slate-900/40 border border-indigo-500/20">
                        <i class="fa-solid fa-fire-flame-curved text-3xl text-orange-500 mb-3"></i>
                        <p class="text-lg font-bold text-white leading-tight">"O sucesso √© a soma de pequenos esfor√ßos repetidos dia ap√≥s dia."</p>
                        <p class="text-[10px] text-slate-400 mt-2 uppercase tracking-widest">Robert Collier</p>
                    </div>
                </div>

                <!-- 3. NOVAS M√âTRICAS -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                    <!-- Investimentos -->
                    <div class="glass-panel p-5 rounded-2xl flex flex-col justify-between card-hover border-b-4 border-emerald-500 relative">
                        <div class="flex justify-between items-start">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 rounded-xl bg-emerald-500/10 flex items-center justify-center text-emerald-400 text-lg"><i class="fa-solid fa-sack-dollar"></i></div>
                                <div>
                                    <p class="text-[10px] text-slate-400 uppercase font-bold tracking-wider">Patrim√¥nio Investido</p>
                                    <h3 class="text-2xl font-black text-white" id="inv-current">R$ 8.500</h3>
                                </div>
                            </div>
                            <button onclick="addInvestment()" class="text-xs bg-emerald-600 hover:bg-emerald-500 text-white w-8 h-8 rounded-full flex items-center justify-center transition shadow-lg"><i class="fa-solid fa-plus"></i></button>
                        </div>
                        <div class="mt-4">
                            <div class="flex justify-between text-[10px] text-slate-400 mb-1">
                                <span>Progresso</span>
                                <span id="inv-pct">38%</span>
                            </div>
                            <div class="w-full bg-slate-800 h-1.5 rounded-full overflow-hidden">
                                <div id="inv-bar" class="bg-emerald-500 h-full w-[38%]"></div>
                            </div>
                            <p class="text-[10px] text-right text-emerald-400/60 mt-1">Meta: R$ 22.000</p>
                        </div>
                    </div>

                    <!-- Countdown -->
                    <div class="glass-panel p-5 rounded-2xl flex items-center gap-4 card-hover border-b-4 border-orange-500">
                        <div class="w-12 h-12 rounded-xl bg-orange-500/10 flex items-center justify-center text-orange-400 text-xl"><i class="fa-solid fa-hourglass-half"></i></div>
                        <div>
                            <p class="text-[10px] text-slate-400 uppercase font-bold tracking-wider">Pr√≥ximo Salto (Fev/26)</p>
                            <h3 class="text-2xl font-black text-white flex items-baseline gap-1">34 <span class="text-sm font-normal text-slate-500">dias</span></h3>
                        </div>
                    </div>

                    <!-- N√≠vel Ingl√™s -->
                    <div class="glass-panel p-5 rounded-2xl flex items-center gap-4 card-hover border-b-4 border-purple-500 relative overflow-hidden">
                        <div class="absolute right-0 top-0 p-4 opacity-10"><i class="fa-solid fa-earth-americas text-6xl text-purple-500"></i></div>
                        <div class="w-12 h-12 rounded-xl bg-purple-500/10 flex items-center justify-center text-purple-400 text-xl"><i class="fa-solid fa-language"></i></div>
                        <div>
                            <p class="text-[10px] text-slate-400 uppercase font-bold tracking-wider">N√≠vel de Ingl√™s</p>
                            <h3 class="text-3xl font-black text-white" id="dash-english-lvl">A1</h3>
                            <p class="text-[10px] text-slate-500">Autom√°tico via Jornada</p>
                        </div>
                    </div>
                </div>

                <!-- Mid Row: Certifications & Health -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                    <!-- Certifications Tracker -->
                    <div class="glass-panel p-6 rounded-3xl col-span-2">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="font-bold text-white"><i class="fa-solid fa-award text-yellow-500 mr-2"></i>Certifica√ß√µes T√©cnicas</h3>
                            <span class="text-xs text-slate-400">Curr√≠culo de Elite</span>
                        </div>
                        <div class="grid grid-cols-2 gap-3 max-h-48 overflow-y-auto pr-1">
                            <label class="custom-checkbox flex items-center p-2.5 bg-slate-800/50 rounded-xl cursor-pointer hover:bg-slate-800 border border-slate-700/50 transition">
                                <input type="checkbox" class="sr-only">
                                <div class="w-4 h-4 border-2 border-slate-500 rounded flex items-center justify-center mr-3 transition-colors flex-shrink-0 bg-slate-900"><svg class="w-3 h-3 text-white hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg></div>
                                <span class="text-xs text-slate-300">Google Ads Search</span>
                            </label>
                            <label class="custom-checkbox flex items-center p-2.5 bg-slate-800/50 rounded-xl cursor-pointer hover:bg-slate-800 border border-slate-700/50 transition">
                                <input type="checkbox" class="sr-only">
                                <div class="w-4 h-4 border-2 border-slate-500 rounded flex items-center justify-center mr-3 transition-colors flex-shrink-0 bg-slate-900"><svg class="w-3 h-3 text-white hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg></div>
                                <span class="text-xs text-slate-300">Google Ads Criativos</span>
                            </label>
                            <label class="custom-checkbox flex items-center p-2.5 bg-slate-800/50 rounded-xl cursor-pointer hover:bg-slate-800 border border-slate-700/50 transition">
                                <input type="checkbox" class="sr-only">
                                <div class="w-4 h-4 border-2 border-slate-500 rounded flex items-center justify-center mr-3 transition-colors flex-shrink-0 bg-slate-900"><svg class="w-3 h-3 text-white hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg></div>
                                <span class="text-xs text-slate-300">Google Ads Shopping</span>
                            </label>
                            <label class="custom-checkbox flex items-center p-2.5 bg-slate-800/50 rounded-xl cursor-pointer hover:bg-slate-800 border border-slate-700/50 transition">
                                <input type="checkbox" class="sr-only">
                                <div class="w-4 h-4 border-2 border-slate-500 rounded flex items-center justify-center mr-3 transition-colors flex-shrink-0 bg-slate-900"><svg class="w-3 h-3 text-white hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg></div>
                                <span class="text-xs text-slate-300">Intro LinkedIn Ads</span>
                            </label>
                            <label class="custom-checkbox flex items-center p-2.5 bg-slate-800/50 rounded-xl cursor-pointer hover:bg-slate-800 border border-slate-700/50 transition">
                                <input type="checkbox" class="sr-only">
                                <div class="w-4 h-4 border-2 border-slate-500 rounded flex items-center justify-center mr-3 transition-colors flex-shrink-0 bg-slate-900"><svg class="w-3 h-3 text-white hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg></div>
                                <span class="text-xs text-slate-300">Google Ads V√≠deo</span>
                            </label>
                            <label class="custom-checkbox flex items-center p-2.5 bg-slate-800/50 rounded-xl cursor-pointer hover:bg-slate-800 border border-slate-700/50 transition">
                                <input type="checkbox" class="sr-only">
                                <div class="w-4 h-4 border-2 border-slate-500 rounded flex items-center justify-center mr-3 transition-colors flex-shrink-0 bg-slate-900"><svg class="w-3 h-3 text-white hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg></div>
                                <span class="text-xs text-slate-300">Google Ads M√©tricas</span>
                            </label>
                            <label class="custom-checkbox flex items-center p-2.5 bg-slate-800/50 rounded-xl cursor-pointer hover:bg-slate-800 border border-slate-700/50 transition">
                                <input type="checkbox" class="sr-only">
                                <div class="w-4 h-4 border-2 border-slate-500 rounded flex items-center justify-center mr-3 transition-colors flex-shrink-0 bg-slate-900"><svg class="w-3 h-3 text-white hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg></div>
                                <span class="text-xs text-slate-300">Make Foundation</span>
                            </label>
                        </div>
                    </div>

                    <!-- Health Tracker -->
                    <div class="glass-panel p-6 rounded-3xl col-span-2 relative overflow-hidden bg-gradient-to-br from-green-900/10 to-slate-900">
                        <div class="flex justify-between items-start mb-4">
                            <h3 class="font-bold text-white"><i class="fa-solid fa-weight-scale text-green-500 mr-2"></i>Monitor Corporal</h3>
                            <span class="text-xs bg-green-500/10 text-green-400 px-2 py-1 rounded border border-green-500/20">Meta: 70kg</span>
                        </div>
                        <div class="flex items-center gap-6">
                            <div class="flex-1">
                                <p class="text-xs text-slate-400 mb-1">Peso Atual</p>
                                <div class="flex items-center gap-2">
                                    <button onclick="adjustWeight(-0.5)" class="w-8 h-8 rounded bg-slate-800 hover:bg-slate-700 text-white">-</button>
                                    <span id="current-weight" class="text-3xl font-bold text-white w-20 text-center">90.0</span>
                                    <span class="text-sm text-slate-500">kg</span>
                                    <button onclick="adjustWeight(0.5)" class="w-8 h-8 rounded bg-slate-800 hover:bg-slate-700 text-white">+</button>
                                </div>
                            </div>
                            <div class="flex-1 text-right">
                                <p class="text-xs text-slate-400 mb-1">Progresso</p>
                                <div class="w-full bg-slate-800 h-2 rounded-full overflow-hidden mt-2">
                                    <div id="weight-bar" class="bg-green-500 h-full transition-all duration-500" style="width: 0%"></div>
                                </div>
                                <p class="text-xs text-green-400 mt-1" id="weight-lost">0kg eliminados</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Bottom Row: Chart -->
                <div class="glass-panel p-6 rounded-3xl border-t-4 border-blue-500">
                    <h3 class="font-bold text-white text-lg mb-6">Evolu√ß√£o Financeira</h3>
                    <div class="h-64 w-full"><canvas id="financeChart"></canvas></div>
                </div>
            </div>

            <!-- ================= VIEW: ROUTINE ================= -->
            <div id="view-routine" class="view-section hidden fade-in">
                
                <!-- 1. HEADER & CALENDAR LINK -->
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
                    <div>
                        <h2 class="text-3xl font-bold text-white">Cronograma Semanal</h2>
                        <p class="text-slate-400 text-sm">Visualiza√ß√£o de Alta Performance</p>
                    </div>
                    
                    <div class="flex gap-2 items-center bg-slate-800 p-2 rounded-xl border border-slate-700">
                        <input type="text" id="calendar-link-input" placeholder="Cole link da sua Agenda..." class="bg-slate-900 border border-slate-600 rounded-lg px-3 py-2 text-xs text-white outline-none w-48 focus:border-blue-500">
                        <button onclick="saveCalendarLink()" class="bg-blue-600 hover:bg-blue-500 text-white px-3 py-2 rounded-lg text-xs font-bold transition">Salvar</button>
                        <a id="calendar-btn" href="#" target="_blank" class="hidden bg-slate-700 hover:bg-slate-600 text-white px-3 py-2 rounded-lg text-xs font-bold transition flex items-center gap-2">
                            <i class="fa-regular fa-calendar"></i> Abrir Agenda
                        </a>
                    </div>
                </div>

                <!-- 2. MAIN LAYOUT: SCHEDULE + TOOLS -->
                <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
                    
                    <!-- Left: Schedule Grid -->
                    <div class="lg:col-span-3">
                        <div class="schedule-grid">
                            <!-- Headers -->
                            <div class="schedule-header">Hora</div><div class="schedule-header">Seg</div><div class="schedule-header">Ter</div><div class="schedule-header">Qua</div><div class="schedule-header">Qui</div><div class="schedule-header">Sex</div>

                            <!-- 06:00 -->
                            <div class="schedule-time">06:00</div>
                            <div class="schedule-cell"><div class="event-block evt-darkpurple">üìö Ingl√™s / Estudo<span class="font-normal opacity-70 text-[9px]">Foco Total</span></div></div><div class="schedule-cell"><div class="event-block evt-darkpurple">üìö Ingl√™s / Estudo</div></div><div class="schedule-cell"><div class="event-block evt-darkpurple">üìö Ingl√™s / Estudo</div></div><div class="schedule-cell"><div class="event-block evt-darkpurple">üìö Ingl√™s / Estudo</div></div><div class="schedule-cell"><div class="event-block evt-darkpurple">üìö Ingl√™s / Estudo</div></div>

                            <!-- 07:00 -->
                            <div class="schedule-time">07:00</div>
                            <div class="schedule-cell"><div class="event-block evt-darkgreen">üèãÔ∏è Treino</div></div><div class="schedule-cell"><div class="event-block evt-darkgreen">üèãÔ∏è Treino</div></div><div class="schedule-cell"><div class="event-block evt-darkgreen">üèãÔ∏è Treino</div></div><div class="schedule-cell"><div class="event-block evt-darkgreen">üèãÔ∏è Treino</div></div><div class="schedule-cell"><div class="event-block evt-darkgreen">üèãÔ∏è Treino</div></div>

                            <!-- 08:00 (Gap) -->
                            <div class="schedule-time">08:00</div><div class="schedule-cell"><div class="event-block evt-lightgreen opacity-50">‚òï Caf√© / Org</div></div><div class="schedule-cell"><div class="event-block evt-lightgreen opacity-50">‚òï Caf√© / Org</div></div><div class="schedule-cell"><div class="event-block evt-lightgreen opacity-50">‚òï Caf√© / Org</div></div><div class="schedule-cell"><div class="event-block evt-lightgreen opacity-50">‚òï Caf√© / Org</div></div><div class="schedule-cell"><div class="event-block evt-lightgreen opacity-50">‚òï Caf√© / Org</div></div>

                            <!-- 09:00 - 12:00 (Work Block) -->
                            <div class="schedule-time">09:00</div>
                            <div class="schedule-cell row-span-4" style="grid-row: span 4;"><div class="event-block evt-black h-full">üöÄ Gest√£o Tr√°fego (V4)</div></div><div class="schedule-cell row-span-4" style="grid-row: span 4;"><div class="event-block evt-black h-full">üöÄ Gest√£o Tr√°fego (V4)</div></div><div class="schedule-cell row-span-4" style="grid-row: span 4;"><div class="event-block evt-black h-full">üöÄ Gest√£o Tr√°fego (V4)</div></div><div class="schedule-cell row-span-4" style="grid-row: span 4;"><div class="event-block evt-black h-full">üöÄ Gest√£o Tr√°fego (V4)</div></div><div class="schedule-cell row-span-4" style="grid-row: span 4;"><div class="event-block evt-black h-full">üöÄ Gest√£o Tr√°fego (V4)</div></div>

                            <div class="schedule-time">10:00</div> <div class="hidden"></div><div class="hidden"></div><div class="hidden"></div><div class="hidden"></div><div class="hidden"></div>
                            <div class="schedule-time">11:00</div> <div class="hidden"></div><div class="hidden"></div><div class="hidden"></div><div class="hidden"></div><div class="hidden"></div>
                            <div class="schedule-time">12:00</div> <div class="hidden"></div><div class="hidden"></div><div class="hidden"></div><div class="hidden"></div><div class="hidden"></div>

                            <!-- 13:00 (Lunch) -->
                            <div class="schedule-time">13:00</div>
                            <div class="schedule-cell"><div class="event-block evt-lightgreen">üçΩÔ∏è Almo√ßo</div></div><div class="schedule-cell"><div class="event-block evt-lightgreen">üçΩÔ∏è Almo√ßo</div></div><div class="schedule-cell"><div class="event-block evt-lightgreen">üçΩÔ∏è Almo√ßo</div></div><div class="schedule-cell"><div class="event-block evt-lightgreen">üçΩÔ∏è Almo√ßo</div></div><div class="schedule-cell"><div class="event-block evt-lightgreen">üçΩÔ∏è Almo√ßo</div></div>

                            <!-- 14:00 - 18:00 (Afternoon Block) -->
                            <div class="schedule-time">14:00</div>
                            <div class="schedule-cell row-span-4" style="grid-row: span 4;"><div class="event-block evt-black h-full">üìä Otimiza√ß√µes / Calls</div></div><div class="schedule-cell row-span-4" style="grid-row: span 4;"><div class="event-block evt-black h-full">üìä Otimiza√ß√µes / Calls</div></div><div class="schedule-cell row-span-4" style="grid-row: span 4;"><div class="event-block evt-black h-full">üìä Otimiza√ß√µes / Calls</div></div><div class="schedule-cell row-span-4" style="grid-row: span 4;"><div class="event-block evt-black h-full">üìä Otimiza√ß√µes / Calls</div></div><div class="schedule-cell row-span-4" style="grid-row: span 4;"><div class="event-block evt-black h-full">üç∫ Encerramento</div></div>

                            <div class="schedule-time">15:00</div> <div class="hidden"></div><div class="hidden"></div><div class="hidden"></div><div class="hidden"></div><div class="hidden"></div>
                            <div class="schedule-time">16:00</div> <div class="hidden"></div><div class="hidden"></div><div class="hidden"></div><div class="hidden"></div><div class="hidden"></div>
                            <div class="schedule-time">17:00</div> <div class="hidden"></div><div class="hidden"></div><div class="hidden"></div><div class="hidden"></div><div class="hidden"></div>

                            <!-- 18:00 (Break) -->
                            <div class="schedule-time">18:00</div>
                            <div class="schedule-cell"></div><div class="schedule-cell"></div><div class="schedule-cell"></div><div class="schedule-cell"></div><div class="schedule-cell"></div>

                            <!-- 19:00 (Evening) -->
                            <div class="schedule-time">19:00</div>
                            <div class="schedule-cell"><div class="event-block evt-darkpurple">üéì Estudos</div></div><div class="schedule-cell"><div class="event-block evt-orange">üí∞ Freela / Prospec√ß√£o</div></div><div class="schedule-cell"><div class="event-block evt-darkpurple">üéì Estudos</div></div><div class="schedule-cell"><div class="event-block evt-orange">üí∞ Freela / Prospec√ß√£o</div></div><div class="schedule-cell"></div>
                        </div>
                    </div>

                    <!-- Right: Tools & Legend -->
                    <div class="lg:col-span-1 space-y-6">
                        
                        <!-- Legend -->
                        <div class="glass-panel p-4 rounded-xl">
                            <h4 class="font-bold text-white text-sm mb-3">Legenda do Sistema</h4>
                            <div class="space-y-2 text-xs text-slate-300">
                                <div class="flex items-center"><span class="legend-dot evt-black"></span> Gest√£o Tr√°fego</div>
                                <div class="flex items-center"><span class="legend-dot evt-red"></span> Urgente üî•</div>
                                <div class="flex items-center"><span class="legend-dot evt-orange"></span> Aten√ß√£o / Freela</div>
                                <div class="flex items-center"><span class="legend-dot evt-rose"></span> Rotina Fixa</div>
                                <div class="flex items-center"><span class="legend-dot evt-darkgreen"></span> Esportes</div>
                                <div class="flex items-center"><span class="legend-dot evt-darkpurple"></span> Intelectual</div>
                                <div class="flex items-center"><span class="legend-dot evt-lightpurple"></span> Reuni√µes</div>
                                <div class="flex items-center"><span class="legend-dot evt-lightgreen"></span> Comer</div>
                            </div>
                        </div>

                        <!-- Daily Protocol -->
                        <div class="glass-panel p-4 rounded-xl border-t-4 border-blue-500">
                            <h4 class="font-bold text-white text-sm mb-3">Protocolo Di√°rio</h4>
                            <div class="space-y-2">
                                <label class="flex items-center gap-2 cursor-pointer group">
                                    <input type="checkbox" class="w-4 h-4 rounded border-slate-600 bg-slate-800 text-blue-500 focus:ring-0">
                                    <span class="text-xs text-slate-300 group-hover:text-white transition">üíß 3L √Ågua</span>
                                </label>
                                <label class="flex items-center gap-2 cursor-pointer group">
                                    <input type="checkbox" class="w-4 h-4 rounded border-slate-600 bg-slate-800 text-blue-500 focus:ring-0">
                                    <span class="text-xs text-slate-300 group-hover:text-white transition">üìñ 10 Pag Leitura</span>
                                </label>
                                <label class="flex items-center gap-2 cursor-pointer group">
                                    <input type="checkbox" class="w-4 h-4 rounded border-slate-600 bg-slate-800 text-blue-500 focus:ring-0">
                                    <span class="text-xs text-slate-300 group-hover:text-white transition">üèãÔ∏è Treino Feito</span>
                                </label>
                                <label class="flex items-center gap-2 cursor-pointer group">
                                    <input type="checkbox" class="w-4 h-4 rounded border-slate-600 bg-slate-800 text-blue-500 focus:ring-0">
                                    <span class="text-xs text-slate-300 group-hover:text-white transition">üö´ Zero A√ß√∫car</span>
                                </label>
                            </div>
                        </div>

                        <!-- Brain Dump -->
                        <div class="glass-panel p-4 rounded-xl">
                            <h4 class="font-bold text-white text-sm mb-2 flex items-center gap-2"><i class="fa-solid fa-brain text-pink-400"></i> Brain Dump</h4>
                            <textarea class="w-full bg-slate-900/50 border border-slate-700 rounded-lg p-2 text-xs text-slate-300 h-32 outline-none focus:border-pink-500 resize-none" placeholder="Ideias r√°pidas, tarefas soltas..."></textarea>
                        </div>

                    </div>
                </div>
            </div>

            <!-- ================= VIEW: ENGLISH ================= -->
            <div id="view-english" class="view-section hidden fade-in">
                <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 h-[800px]">
                    <!-- Left: Levels -->
                    <div class="lg:col-span-4 flex flex-col h-full gap-4">
                        <div class="glass-panel p-6 rounded-2xl flex-1 border border-purple-500/20">
                            <h3 class="font-bold text-white mb-4">Progresso de N√≠vel</h3>
                            <div class="space-y-3">
                                <div class="flex items-center justify-between p-3 bg-slate-800/50 rounded-xl border border-slate-700">
                                    <div><p class="font-bold text-white">A1 (B√°sico)</p><p class="text-xs text-slate-400">Conclu√≠do</p></div>
                                    <label class="custom-checkbox relative flex items-center cursor-pointer"><input type="checkbox" class="level-check sr-only" onchange="updateEnglishLevel('A1')" id="lvl-a1"><div class="w-6 h-6 border-2 border-slate-500 rounded flex items-center justify-center transition-colors"><svg class="w-4 h-4 text-white hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg></div></label>
                                </div>
                                <div class="flex items-center justify-between p-3 bg-slate-800/50 rounded-xl border border-slate-700">
                                    <div><p class="font-bold text-white">A2 (Elementar)</p><p class="text-xs text-slate-400">Fev - Abr</p></div>
                                    <label class="custom-checkbox relative flex items-center cursor-pointer"><input type="checkbox" class="level-check sr-only" onchange="updateEnglishLevel('A2')" id="lvl-a2"><div class="w-6 h-6 border-2 border-slate-500 rounded flex items-center justify-center transition-colors"><svg class="w-4 h-4 text-white hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg></div></label>
                                </div>
                                <div class="flex items-center justify-between p-3 bg-slate-800/50 rounded-xl border border-slate-700 opacity-80">
                                    <div><p class="font-bold text-white">B1 (Intermedi√°rio)</p><p class="text-xs text-slate-400">Mai - Ago</p></div>
                                    <label class="custom-checkbox relative flex items-center cursor-pointer"><input type="checkbox" class="level-check sr-only" onchange="updateEnglishLevel('B1')" id="lvl-b1"><div class="w-6 h-6 border-2 border-slate-500 rounded flex items-center justify-center transition-colors"><svg class="w-4 h-4 text-white hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg></div></label>
                                </div>
                                <div class="flex items-center justify-between p-3 bg-slate-800/50 rounded-xl border border-slate-700 opacity-60">
                                    <div><p class="font-bold text-white">B2 (Flu√™ncia)</p><p class="text-xs text-slate-400">Set - Dez</p></div>
                                    <label class="custom-checkbox relative flex items-center cursor-pointer"><input type="checkbox" class="level-check sr-only" onchange="updateEnglishLevel('B2')" id="lvl-b2"><div class="w-6 h-6 border-2 border-slate-500 rounded flex items-center justify-center transition-colors"><svg class="w-4 h-4 text-white hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg></div></label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Right: Audio Chat -->
                    <div class="lg:col-span-8 flex flex-col gap-4">
                        <div class="glass-panel p-6 rounded-2xl flex-1 flex flex-col bg-slate-950/50 h-full relative overflow-hidden">
                            <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-purple-500 to-pink-500"></div>
                            <div class="flex items-center justify-between mb-4 pb-4 border-b border-white/5">
                                <div class="flex items-center gap-3">
                                    <img src="https://ui-avatars.com/api/?name=Teacher+AI&background=7c3aed&color=fff" class="w-12 h-12 rounded-full border-2 border-purple-500">
                                    <div><h3 class="font-bold text-white">Prof. Gemini (Audio)</h3><p class="text-xs text-purple-400">Conversation Mode: ON</p></div>
                                </div>
                                <div id="listening-indicator" class="hidden"><div class="listening-wave"><span></span><span></span><span></span></div><span class="text-xs text-red-400 ml-2 font-bold">Ouvindo...</span></div>
                            </div>
                            <div id="teacher-messages" class="flex-1 overflow-y-auto space-y-4 pr-2 pb-4">
                                <div class="flex gap-3">
                                    <img src="https://ui-avatars.com/api/?name=Teacher+AI&background=7c3aed&color=fff" class="w-8 h-8 rounded-full self-end mb-1">
                                    <div class="teacher-bubble-ai p-3 text-sm">Hello Luan! I am your AI Tutor. Press the microphone to speak with me.</div>
                                </div>
                            </div>
                            <div class="mt-4 flex gap-2 relative items-center">
                                <button onclick="toggleMic()" id="mic-btn" class="w-12 h-12 rounded-full bg-slate-800 hover:bg-red-500 text-white transition flex items-center justify-center border border-slate-700 hover:border-red-400 shadow-lg group"><i class="fa-solid fa-microphone text-xl group-hover:animate-pulse"></i></button>
                                <input type="text" id="teacher-input" class="flex-1 bg-slate-900 border border-slate-700 rounded-xl px-4 py-3 text-sm text-white focus:border-purple-500 outline-none shadow-inner" placeholder="Type or speak..." onkeypress="handleTeacherEnter(event)">
                                <button onclick="sendToTeacher()" class="bg-purple-600 hover:bg-purple-500 text-white p-3 rounded-xl transition shadow-lg shadow-purple-500/20"><i class="fa-solid fa-paper-plane"></i></button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Other Views -->
            <div id="view-v4" class="view-section hidden fade-in"><div class="glass-panel p-8 rounded-3xl"><h2 class="text-white text-xl">M√≥dulo V4 (Ver vers√µes anteriores)</h2></div></div>
            <div id="view-freela" class="view-section hidden fade-in"><div class="glass-panel p-8 rounded-3xl"><h2 class="text-white text-xl">M√≥dulo Freela (Ver vers√µes anteriores)</h2></div></div>

        </div>
    </main>

    <!-- AI HUB (FLOATING) -->
    <div class="fixed bottom-8 right-8 z-50 flex flex-col items-end">
        <div id="ai-chat-window" class="hidden w-80 md:w-96 bg-slate-900 border border-slate-700 rounded-2xl shadow-2xl mb-4 overflow-hidden flex flex-col h-[500px] transition-all theme-tutor">
            <!-- Header with Persona Switch -->
            <div class="bg-slate-800 p-3 border-b border-slate-700">
                <div class="flex bg-slate-900 rounded-lg p-1 mb-2">
                    <button onclick="setAIMode('tutor')" id="btn-mode-tutor" class="flex-1 py-1.5 text-xs font-bold rounded-md bg-slate-700 text-white shadow transition-all">üá∫üá∏ English Tutor</button>
                    <button onclick="setAIMode('coach')" id="btn-mode-coach" class="flex-1 py-1.5 text-xs font-bold rounded-md text-slate-400 hover:text-white transition-all">üß† Strategic Coach</button>
                </div>
                <div class="flex justify-between items-center px-1">
                    <div class="flex items-center gap-2">
                        <div id="ai-avatar" class="w-6 h-6 rounded-full bg-purple-600 flex items-center justify-center text-[10px] text-white"><i class="fa-solid fa-graduation-cap"></i></div>
                        <span id="ai-name" class="text-sm font-bold text-white">English Teacher</span>
                    </div>
                    <button onclick="toggleChat()" class="text-slate-400 hover:text-white"><i class="fa-solid fa-times"></i></button>
                </div>
            </div>

            <!-- Chat Area -->
            <div id="chat-messages" class="flex-1 p-4 overflow-y-auto space-y-4 bg-slate-950">
                <div class="chat-bubble-ai p-3 text-sm">Hello Luan! Ready to improve your English today?</div>
            </div>

            <!-- Input -->
            <div class="p-3 bg-slate-800 border-t border-slate-700">
                <div class="relative flex gap-2">
                    <input type="text" id="chat-input" placeholder="Type message..." class="w-full bg-slate-900 text-slate-200 text-sm rounded-lg pl-3 pr-10 py-2 border border-slate-700 focus:outline-none focus:border-blue-500" onkeypress="handleChatEnter(event)">
                    <button onclick="handleChatMessage()" class="text-blue-500 hover:text-blue-400 p-2"><i class="fa-solid fa-paper-plane"></i></button>
                </div>
            </div>
        </div>

        <button onclick="toggleChat()" class="w-16 h-16 rounded-full bg-gradient-to-r from-blue-600 to-indigo-600 shadow-[0_0_20px_rgba(37,99,235,0.5)] flex items-center justify-center text-white text-2xl hover:scale-110 transition-transform border border-white/20">
            <i class="fa-solid fa-robot"></i>
        </button>
    </div>

    <script>
        const apiKey = "AIzaSyD9aqaHvwwg52ycVzwlnjeQAhHwC0nUkfc"; // API Key Injected by Environment

        // --- GLOBAL STATE ---
        let currentWeight = 90.0;
        let investmentCurrent = 8500.0;
        let investmentGoal = 22000.0;
        let state = { v4Salary: 3700, clients: [] };
        let aiMode = 'tutor'; // 'tutor' or 'coach'

        // --- NAVIGATION ---
        function switchTab(tabId) {
            document.querySelectorAll('.view-section').forEach(el => el.classList.add('hidden'));
            document.getElementById('view-' + tabId).classList.remove('hidden');
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('bg-white/10', 'text-white', 'shadow-lg');
                btn.classList.add('text-slate-400');
            });
            const btn = document.getElementById('nav-' + tabId);
            if(btn) {
                if(tabId === 'dashboard') btn.classList.add('bg-red-600', 'text-white', 'shadow-lg');
                else btn.classList.add('bg-white/10', 'text-white');
                btn.classList.remove('text-slate-400');
            }
        }

        // --- CALENDAR LOGIC ---
        function saveCalendarLink() {
            const link = document.getElementById('calendar-link-input').value;
            if(link) {
                const btn = document.getElementById('calendar-btn');
                btn.href = link;
                btn.classList.remove('hidden');
                document.getElementById('calendar-link-input').classList.add('hidden');
                document.querySelector('button[onclick="saveCalendarLink()"]').classList.add('hidden');
            }
        }

        // --- INVESTMENTS LOGIC ---
        function addInvestment() {
            const amountStr = prompt("Valor do novo aporte (R$):", "0");
            if(amountStr) {
                const amount = parseFloat(amountStr.replace(',', '.'));
                if(!isNaN(amount)) {
                    investmentCurrent += amount;
                    updateInvestmentDisplay();
                }
            }
        }

        function updateInvestmentDisplay() {
            document.getElementById('inv-current').innerText = `R$ ${investmentCurrent.toLocaleString('pt-BR')}`;
            const pct = Math.min((investmentCurrent / investmentGoal) * 100, 100);
            const pctText = Math.round(pct) + '%';
            document.getElementById('inv-pct').innerText = pctText;
            document.getElementById('inv-bar').style.width = pctText;
        }

        // --- UPDATE DASHBOARD MAIN STATS ---
        function updateDashboardMainStats(totalIncome) {
            document.getElementById('main-total-income').innerText = `R$ ${totalIncome.toLocaleString('pt-BR')}`;
            const goal = 9000;
            const pct = Math.min((totalIncome / goal) * 100, 100);
            const pctText = Math.round(pct) + '%';
            document.getElementById('main-progress-pct').innerText = pctText;
            document.getElementById('main-progress-bar').style.width = pctText;
            document.getElementById('global-progress-text').innerText = pctText;
            document.getElementById('global-progress-bar').style.width = pctText;
            document.getElementById('dash-v4-current-mini').innerText = `R$ ${totalIncome.toLocaleString('pt-BR')}`;
        }

        // --- ENGLISH LEVEL UPDATE ---
        function updateEnglishLevel(lvl) {
            document.getElementById('dash-english-lvl').innerText = lvl;
        }

        // --- HEALTH TRACKER ---
        function adjustWeight(amount) {
            currentWeight += amount;
            currentWeight = Math.round(currentWeight * 10) / 10;
            document.getElementById('current-weight').innerText = currentWeight.toFixed(1);
            const totalLoss = 90.0 - currentWeight;
            const percentage = (totalLoss / 20.0) * 100;
            document.getElementById('weight-bar').style.width = `${Math.max(0, Math.min(percentage, 100))}%`;
            document.getElementById('weight-lost').innerText = `${totalLoss.toFixed(1)}kg eliminados`;
        }

        // --- AI HUB LOGIC ---
        function toggleChat() {
            document.getElementById('ai-chat-window').classList.toggle('hidden');
        }

        function setAIMode(mode) {
            aiMode = mode;
            const chatWindow = document.getElementById('ai-chat-window');
            const msgs = document.getElementById('chat-messages');
            
            // UI Reset
            msgs.innerHTML = '';
            
            if (mode === 'tutor') {
                chatWindow.classList.remove('theme-coach');
                chatWindow.classList.add('theme-tutor');
                document.getElementById('btn-mode-tutor').className = "flex-1 py-1.5 text-xs font-bold rounded-md bg-slate-700 text-white shadow transition-all";
                document.getElementById('btn-mode-coach').className = "flex-1 py-1.5 text-xs font-bold rounded-md text-slate-400 hover:text-white transition-all";
                document.getElementById('ai-name').innerText = "English Teacher";
                document.getElementById('ai-avatar').className = "w-6 h-6 rounded-full bg-purple-600 flex items-center justify-center text-[10px] text-white";
                document.getElementById('ai-avatar').innerHTML = '<i class="fa-solid fa-graduation-cap"></i>';
                msgs.innerHTML = '<div class="chat-bubble-ai p-3 text-sm">Hello Luan! Ready to practice English? üá∫üá∏</div>';
            } else {
                chatWindow.classList.remove('theme-tutor');
                chatWindow.classList.add('theme-coach');
                document.getElementById('btn-mode-coach').className = "flex-1 py-1.5 text-xs font-bold rounded-md bg-emerald-700 text-white shadow transition-all";
                document.getElementById('btn-mode-tutor').className = "flex-1 py-1.5 text-xs font-bold rounded-md text-slate-400 hover:text-white transition-all";
                document.getElementById('ai-name').innerText = "Strategic Coach";
                document.getElementById('ai-avatar').className = "w-6 h-6 rounded-full bg-emerald-600 flex items-center justify-center text-[10px] text-white";
                document.getElementById('ai-avatar').innerHTML = '<i class="fa-solid fa-chess"></i>';
                msgs.innerHTML = '<div class="chat-bubble-ai p-3 text-sm">Ol√°, Luan. Sou seu estrategista. Vamos analisar suas metas? üß†</div>';
            }
        }

        async function callGemini(text, mode) {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            
            let systemPrompt = "";
            if (mode === 'tutor') {
                systemPrompt = `Act as an English Tutor for Luan (A1 level). Correct grammar gently. Keep conversation going. Reply concisely.`;
            } else {
                systemPrompt = `You are a high-performance Strategic Coach for Luan. 
                Context: V4 Salary: R$ ${state.v4Salary} (Goal 6k). Investments: R$ ${investmentCurrent} (Goal 22k). English: A1.
                User Query: "${text}"
                Task: Provide specific, actionable advice on career, productivity, or business strategy. Be direct, professional, and encouraging. Use Portuguese.`;
            }

            const payload = {
                contents: [{ parts: [{ text: text }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] }
            };

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(payload)
                });
                const data = await response.json();
                return data.candidates[0].content.parts[0].text;
            } catch (e) { return "Erro de conex√£o com o c√©rebro digital. Tente novamente."; }
        }

        async function handleChatMessage() {
            const input = document.getElementById('chat-input');
            const text = input.value.trim();
            if(!text) return;

            const msgs = document.getElementById('chat-messages');
            msgs.innerHTML += `<div class="flex justify-end"><div class="chat-bubble-user p-3 text-sm">${text}</div></div>`;
            input.value = '';
            msgs.scrollTop = msgs.scrollHeight;

            // Loading
            const loadingId = 'loading-' + Date.now();
            msgs.innerHTML += `<div id="${loadingId}" class="flex"><div class="chat-bubble-ai p-3 text-sm"><i class="fa-solid fa-circle-notch fa-spin"></i></div></div>`;
            msgs.scrollTop = msgs.scrollHeight;

            const response = await callGemini(text, aiMode);
            
            document.getElementById(loadingId).remove();
            msgs.innerHTML += `<div class="flex"><div class="chat-bubble-ai p-3 text-sm prose prose-invert max-w-none">${marked.parse(response)}</div></div>`;
            msgs.scrollTop = msgs.scrollHeight;
        }

        function handleChatEnter(e) { if(e.key === 'Enter') handleChatMessage(); }

        // --- TUTOR PAGE CHAT (REUSED LOGIC) ---
        // Keeps the existing tutor chat on the English page working independently or linked. 
        // For simplicity in this v4.0, the floating hub is the main AI interaction point.

        // --- INIT ---
        document.addEventListener('DOMContentLoaded', () => {
            const ctxD = document.getElementById('incomeDistChart').getContext('2d');
            new Chart(ctxD, { type: 'doughnut', data: { labels: ['V4', 'Freela'], datasets: [{ data: [3700, 0], backgroundColor: ['#ef4444', '#eab308'], borderWidth: 0 }] }, options: { plugins: { legend: { display: false } }, cutout: '75%' } });

            const ctxF = document.getElementById('financeChart').getContext('2d');
            new Chart(ctxF, { type: 'line', data: { labels: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'], datasets: [{ label: 'Meta', data: [3700, 4200, 4200, 4200, 6200, 6200, 6700, 6700, 8350, 8350, 8350, 9000], borderColor: '#64748b', borderDash: [5,5] }, { label: 'Realidade', data: [3700, 3700], borderColor: '#3b82f6', backgroundColor: 'rgba(59, 130, 246, 0.1)', fill: true }] }, options: { plugins: { legend: { display: false } }, scales: { y: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#64748b' } }, x: { grid: { display: false } } } } });
            
            updateDashboardMainStats(3700);
            updateInvestmentDisplay();
            setAIMode('tutor'); // Init AI Hub
        });
    </script>
</body>
</html>

